<!-- nuxeo boxes macros -->
<!-- $Id$ -->


<!-- ============================================================ -->
<metal:block define-macro="basebox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" 
      tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
        ...
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="textbox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" 
      tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd"
           tal:content="structure box/box/text">
        box text body
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_default">
  <metal:block use-macro="here/box_lib/macros/sbox">
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
       <tal:block define="
          folder python:box['box'].getFolderObject(here);
          no_form not:nothing;
          items python:box['box'].getFolderContents(here);
          format string:compact;
          columns python:1;
          items_per_page python:10;
          nav_action string:folder_view">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
        </tal:block>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_center"
  tal:define="items python:box['box'].getFolderContents(here)">
  <tal:block condition="python:len(items)>0">
  <metal:block use-macro="here/box_lib/macros/sbox">
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
       <tal:block define="
          folder python:box['box'].getFolderObject(here);
          no_form not:nothing;
          format string:detail;
          columns python:1;
          items_per_page python:10;
          nav_action string:folder_view">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
        </tal:block>
      </div>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" 
      tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
        <span tal:repeat="item python:box['box'].getTree(here)">
          <span tal:replace="structure python:'&nbsp;'*4*item['depth']">&nbsp;</span><a href="." tal:attributes="class python:context_url.endswith(item['rpath']) and 'selected' or default;
                                 href string:${base_url}${item/rpath}/;"><span tal:replace="structure string:${item/short_title}">id</span></a><span tal:condition="item/nb_children" tal:replace="string:*" /><br/>
        </span>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_center"
  tal:define="items python:box['box'].getTree(here);">

 <tal:block condition="python: len(items)>0">
   <tal:block define="root python:items[0];
                      depth python:root['depth']+1;
                      items python:items[1:];
                      nb_item python:len(items);
                      global treenb_row  python:nb_item/2+2;">
      <table width="100%">
	<tr><td valign="top" width="50%">
        <tal:block repeat="item items">
          <tal:block condition="python:item['depth']==depth">
          <br tal:condition="not:repeat/item/start" />
	  <tal:block condition="python:repeat['item'].number() >= treenb_row">
            <tal:block replace='structure string:</td><td width="50%" valign="top">'
	      define="global treenb_row python:nb_item + 1"/>
	  </tal:block>



        <tal:block define="global last_child python: repeat['item'].number() + item['nb_children']" />
<b><a href="." tal:attributes="href string:${base_url}${item/rpath}/" ><img src="" alt="[Link]" border="0"
      tal:attributes="src string:${base_url}folder_icon.gif" />&nbsp;<span tal:replace="structure string:${item/title_or_id}">title</span></a></b><span tal:condition="item/nb_children" tal:replace="string::" /><br/>
          </tal:block>
          <tal:block condition="python:item['depth']>depth">
<a href="." tal:attributes="href string:${base_url}${item/rpath}/"><span tal:replace="structure string:${item/title_or_id}">title</span></a><span tal:condition="item/nb_children" tal:replace="string:..." /><span tal:condition="python: repeat['item'].number() != last_child">,&nbsp;</span><span tal:condition="python: repeat['item'].number() == last_child">.<br/></span>
          </tal:block>

        </tal:block>
	</td></tr></table>
   </tal:block>
 </tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_default"
  tal:define="items python:box['box'].getActions(here, actions)">
  <tal:block condition="python:len(items)">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <tal:block repeat="category items">
      <div tal:attributes="class python:'content '+ test(repeat['category'].odd(), 'even', 'odd')">
        <ul>
          <li tal:repeat="action category">
            <a i18n:translate="" tal:attributes="href action/url"
               tal:content="action/name">
               Action
             </a>
          </li>
        </ul>
      </div>
      </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_user"
  tal:define="items python:box['box'].getActions(here, actions)">
  <tal:block condition="python:len(items)">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <tal:block repeat="category items">
      <div tal:attributes="class python:'content '+ test(repeat['category'].odd(), 'even', 'odd')">
        <ul>
          <li tal:repeat="action category">
            <a tal:attributes="href action/url"
               tal:content="action/name">
               Action
             </a>
          </li>
        </ul>
      </div>
      </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>

	