<metal:html>

<metal:body use-macro="here/content_lib/macros/master">

<metal:block fill-slot="header" />

<metal:main fill-slot="main"
            tal:define="mtool here/portal_membership;
                        member mtool/getAuthenticatedMember;
                        registered python:member.has_role('Member');
                        ptool here/portal_properties">

  <h1 i18n:translate="heading_join_form">Become a member</h1>

  <div tal:condition="registered">
    <p>
      <span i18n:translate="description_join_form_already_member_1">
        You are already a member. You may use the
      </span>
      <a href="personalize_form">
        <span i18n:translate="link_form_already_member">
          personalization form
        </span>
      </a>
      <span i18n:translate="description_join_form_already_member_2">
        to change your membership information.
      </span>
    </p>
  </div><!-- registered -->

  <div tal:condition="not:registered">
    <p i18n:translate="help_join_form_1">
      Becoming a member gives you the ability to personalize the site
      and participate in the community.
    </p>

    <p i18n:translate="help_join_form_2">
      It does not cost any money to become a member and your email and
      other personal information will remain private.</p>

    <p tal:condition="python: ptool.validate_email">
      <span i18n:translate="help_join_form_3">
        You must submit a valid email address. This address will be used
        to send you a randomly-generated password.  Once you have logged
        in with this password, you may change it to anything you like.
      </span>
    </p>

    <form action="register" method="POST"
          tal:attributes="action string:${here/portal_url}/register">

    <input type="hidden" name="last_visit:date" value=""
           tal:attributes="value here/ZopeTime" />
    <input type="hidden" name="prev_visit:date" value=""
           tal:attributes="value here/ZopeTime" />

    <table border="0" width="100%" cellpadding="1" cellspacing="0"
      summary="login info layout"">
      <tr>
        <th i18n:translate="label_user_name"> Login Name </th>
        <td>
          <input type="text" name="username" size="30" value="" id="field_focus"
                 tal:attributes="value request/username|nothing" />
        </td>
      </tr>

      <tr>
        <th i18n:translate="label_email"> Email Address </th>
        <td align="left" valign="top">
          <input type="text" name="email" size="30" value=""
                 tal:attributes="value request/email|nothing" />
        </td>
      </tr>

      <tal:block condition="not:ptool/validate_email">
        <tr>
          <th i18n:translate="label_password"> Password </th>
          <td align="left" valign="top">
            <input type="password" name="password" size="30" value=""
                   tal:attributes="value request/password|nothing" />
          </td>
        </tr>

        <tr>
          <th i18n:translate="label_password_confirm"> Password (confirm) </th>
          <td align="left" valign="top">
            <input type="password" name="confirm" size="30" value=""
                   tal:attributes="value request/confirm|nothing" />
          </td>
        </tr>

        <tr>
          <th i18n:translate="label_password_mailed"> Mail Password?  </th>
          <td>
            <input type="checkbox" name="mail_me" size="30" id="cb_mailme"
                   tal:attributes="checked request/mail_me|nothing" />
            <label for="cb_mailme">
              <em i18n:translate="help_password_message">
                Check this box to have your password
                mailed to you.
              </em>
            </label>
          </td>
        </tr>
      </tal:block>

      <tr>
        <td></td>
        <td>
          <input i18n:attributes="value" class="standalone"
                 type="submit" name="submit" value="button_register" />
        </td>
      </tr>
    </table>

    </form>

  </div><!-- not registered -->

</metal:main>
</metal:body>
</metal:html>
