<!-- macro library for all general use -->
<!-- $Id$ -->

<!-- ============================================================ -->
<metal:block define-macro="portal_message">
<div class="message"
     tal:define="portal_status_message portal_status_message |
                                       request/portal_status_message |
                                       nothing"
     tal:condition="portal_status_message"
     tal:content="portal_status_message"
     i18n:translate="">
  Translated status message.
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="breadcrumbs">
  <tal:block i18n:translate="label_you_are_here">You are
  here:&nbsp;</tal:block><tal:block repeat="bc
  python:here.getBreadCrumbs(url=context_url, breadcrumb_set=getattr(request,
  'breadcrumb_set', None))">
    <a href="/cps/id"
       tal:omit-tag="not:bc/url"
       tal:attributes="href bc/url;
                       title bc/longtitle|nothing;
                       accesskey python:test(repeat['bc'].end, nothing, 'U')"
       tal:content="bc/title">
       Title
    </a><strong
    tal:condition="not:repeat/bc/end">&nbsp;&gt;&nbsp;</strong></tal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="search_folder_prefix_option"
  tal:define="id sfpo_id|string:fp;id1 string:${id}1; id2 string:${id}2;
  contextualSearch python:request.has_key('folder_prefix') and request.get('folder_prefix')
  ">
  <input type="radio" name="folder_prefix" class="noborder"
    tal:attributes="id id1;
      checked contextualSearch;
      value python: utool.getRelativeUrl(here)" />
  <label tal:attributes="for id1"
    i18n:translate="label_search_here">here</label>
  <input type="radio" name="folder_prefix" value="" class="noborder"
    tal:attributes="id id2;
    checked not:contextualSearch" />
  <label tal:attributes="for id2"
    i18n:translate="label_search_all_site">all</label><br />
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="search_form">
  <dl class="form">
    <dt>
      <label i18n:translate="label_search_title">
        Title
      </label>
    </dt>
    <dd>
      <input id="field_focus" name="Title" value="" size="20"
             tal:attributes="value request/Title|nothing" />
    </dd>
    <dt>
      <label i18n:translate="label_search_description">
        Description
      </label>
    </dt>
    <dd>
      <input name="Description" value="" size="20"
             tal:attributes="value request/Description|nothing" />
    </dd>
    <dt>
      <label i18n:translate="label_search_full_text">
        Full text
      </label>
    </dt>
    <dd>
      <input name="SearchableText" value="" size="40"
             tal:attributes="value request/SearchableText|nothing" />
    </dd>
    <dt tal:condition="not:isAnon">
      <label i18n:translate="label_search_status">
        Status
      </label>
    </dt>
    <dd tal:condition="not:isAnon">
      <select name="review_state">
        <option tal:attributes="selected not:request/review_state|nothing"
                value="" i18n:translate="label_all">All</option>
        <option tal:repeat="stateName here/getWorkflowStateNames"
                tal:attributes="value stateName;
                                selected python:request.get('review_state') ==
                                  stateName or None"
                tal:content="string:label_${stateName}"
                i18n:translate="">State name</option>
      </select>
    </dd>
    <dt>
      <label i18n:translate="label_search_portal_type">
        Document type
      </label>
    </dt>
    <dd>
      <select size="5" name="portal_type" multiple="multiple">
        <option tal:attributes="selected not:request/portal_type|nothing"
                value="" i18n:translate="label_all">All</option>
        <option tal:repeat="ret python:here.getSortedContentTypes(allowed=0)"
                tal:attributes="value ret/id;
                                selected python:request.get('portal_type') ==
                                  ret.getId() or None"
                tal:content="ret/Title"
                i18n:translate=""></option>
      </select>
    </dd>
    <dt>
      <label i18n:translate="label_subject">
        Subject
      </label>
    </dt>
    <dd>
      <select size="5" name="Subject" multiple="multiple">
        <option value="" tal:attributes="selected not:request/Subject|nothing"
                i18n:translate="label_all">All</option>
        <option  tal:define="subjects here/getSortedSubjects"
                 tal:repeat="item subjects/items"
                 tal:attributes="value python:item[0];
                                 selected python:request.get('Subject') ==
                                   item[0] or None"
                 tal:content="python:item[1]"
                 i18n:translate=""></option>
      </select>
    </dd>
    <dt>
      <label i18n:translate="label_search_modified_since">
        Modified since
      </label>
    </dt>
    <dd tal:define="today python:here.ZopeTime().earliestTime();
                    default python:modules['DateTime'].DateTime(0, 'GMT');
                    lastLogin member/last_login_time|nothing;
                    yesterday python:today - 1;
                    lastWeek python:today - 7;
                    lastMonth python:today - 31;
                    modified request/modified|nothing">
      <select name="modified:date">
        <option tal:attributes="value default;
                                selected python:request.get('modified',
                                  default) == default or nothing"
                i18n:translate="label_choose">Choose</option>
        <option tal:condition="not:isAnon"
                tal:attributes="value lastLogin;
                                selected python:modified == lastLogin or None"
                i18n:translate="time_last_login">Last login</option>
        <option tal:attributes="value yesterday;
                                selected python:modified == yesterday or None"
                i18n:translate="time_yesterday">Yesterday</option>
        <option tal:attributes="value lastWeek;
                                selected python:modified == lastWeek or None"
                i18n:translate="time_last_week">Last week</option>
        <option tal:attributes="value lastMonth;
                                selected python:modified == lastMonth or None"
                i18n:translate="time_last_month">Last month</option>
      </select>
      <input type="hidden" name="modified_usage" value="range:min" />
    </dd>
    <dt>
      <label i18n:translate="label_search_location">
        Search location
      </label>
    </dt>
    <dd>
      <metal:block use-macro="here/generic_lib/macros/search_folder_prefix_option" />
    </dd>
  </dl>
  <p class="buttonArea">
    <input type="submit" value="button_search" class="standalone"
           i18n:attributes="value" />
  </p>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="accessibility">
<div class="hidden">
  <a accesskey="0" tal:attributes="href string:${base_url}accessibility"
    i18n:translate="accessibility_page_link">Accessibility</a>
  <a accesskey="1" tal:attributes="href string:${base_url}"
    i18n:translate="accessibility_home_link">Go to the homepage</a>
  <a accesskey="2" href="#content"
    i18n:translate="accessibility_content_link">Go to the content</a>
  <a accesskey="3" href="#menu"
    i18n:translate="accessibility_menu_link">Go to the menu</a>
  <a accesskey="4" tal:attributes="href string:${base_url}advanced_search_form"
    i18n:translate="accessibility_search_link">Go to search engine</a>
  <a accesskey="9"
    tal:define="contact_email here/portal_properties/email_from_address"
    tal:attributes="href string:mailto:${contact_email}?subject=Info"
    i18n:translate="accessibility_contact_link">Contact</a>
</div>
</metal:block>
