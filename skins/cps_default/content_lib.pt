<!-- macro library for contents -->
<!-- $Id$ -->

<!-- ============================================================ -->
<pre>a master macro used for content stuff:</pre>
<metal:block define-macro="master"
  tal:define="proxy here/this;
  doc doc|here/getContent|nocall:here">
<metal:block use-macro="here/main_template/macros/master">
 <metal:block fill-slot="base">
<tal:block replace="structure string:<!--
  cps test / debug information:
  cps:path:${here/absolute_url}
  cps:rpath:${context_url}
  cps:proxy_id:${proxy/id}
  cps:id:${doc/id}
-->"></tal:block>
<metal:block define-slot="base">
  <base href="" tal:attributes="href python: here.absolute_url() + '/'">
</metal:block>
</metal:block>

<metal:block fill-slot="header">
<metal:block define-slot="header">
  <h1 tal:content="here/title_or_id">Page Title</h1>
  <div metal:use-macro="here/content_lib/macros/byline">By Me</div>
  <div class="description" tal:content="doc/Description">
    Document Description goes here.
   </div>
</metal:block>
</metal:block>

<metal:block fill-slot="main">
<metal:block define-slot="main" />
</metal:block>

<metal:block fill-slot="sub">
<metal:block define-slot="sub">
  <div class="box" tal:condition="doc/viewThreadsAtBottom|nothing"
    tal:content="structure doc/viewThreadsAtBottom">
    Discussion goes here
   </div>
</metal:block>
</metal:block>

</metal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a std formated main:</pre>
<metal:block define-macro="std_main">
  <h1><metal:block define-slot="title">title</metal:block></h1>
  <em><metal:block define-slot="help">help</metal:block></em><br><br>
  <metal:block define-slot="main">main bla</metal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a header for a document or folder:</pre>
<div metal:define-macro="byline"
     tal:define="creator doc/Creator;
                 home_url python: here.portal_membership.getHomeUrl(creator)">
<p i18n:translate="">
  Created by
  <a href="." title="Here" tal:omit-tag="not: home_url"
     tal:attributes="href string:${home_url}/; title creator"
     tal:content="creator" i18n:name="item_creator">Creator</a>.
  Last modified
  <span tal:content="python:doc.ModificationDate()"
        i18n:name="item_modification">Today</span>.
</p>
</div>


<!-- ============================================================ -->
<pre>form used for state transition:</pre>
<metal:block define-macro="transition_form">
<form method="post" action="content_status_modify"
  tal:attributes="action string:${proxy/absolute_url}/content_status_modify">
  <div metal:define-slot="fields">
    <!-- more fields -->
  </div>
  <strong><em i18n:translate="transition_comments">Comments</em></strong><br>
  <textarea name="comment" cols="60" rows="5" wrap="soft" style="width: 100%"
            tal:content="nothing">
  </textarea>
  <div metal:define-slot="button">
    <!-- these are examples -->
    <input type="hidden" name="workflow_action" value="transition">
    <input type="submit" value="button_publish" i18n:attributes="value">
  </div>
</form>
</metal:block>


<!-- ============================================================ -->
<pre>list contents in 'items' in the specified number of columns with the given
format:</pre>
<metal:block define-macro="display_contents">
<tal:block
  define="tmp_format format|nothing;
          tmp_sort_by sort_by|nothing;
          tmp_direction direction|nothing;
          tmp_columns columns|nothing;
          tmp_items_per_page items_per_page|nothing;
          tmp_nav_action nav_action|nothing;
          params python:here.getDisplayParams(format=tmp_format,
                          sort_by = tmp_sort_by,
                          direction = tmp_direction,
                          columns = tmp_columns,
                          items_per_page = tmp_items_per_page,
                          nav_action = tmp_nav_action,
                          nb_items = len(items));
          format params/format;
          sort_by params/sort_by;
          direction params/direction;
          columns params/columns;
          items_per_page params/items_per_page;
          nav_action params/nav_action;
          mq nocall:modules/ZTUtils/make_query;
          form request/form;
          batches_all python:here.getBatchList(items,
          columns,items_per_page);
          batches python:batches_all[0];
          batch_string python:batches_all[1];
          batch_info python:batches_all[2];
     ">
  <tal:block condition="python:batch_string is not None">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr bgcolor="#EEEEEE">
        <td align="right" width="100%">
          <span i18n:translate="label_result_objects">
            Objects
          </span>
          &nbsp;:&nbsp;
          <span tal:replace="structure batch_info" />
        </td>
      </tr>
      <tal:block condition="batch_string">
      <tr>
        <td align="left" width="100%">
          <span tal:replace="structure batch_string" />
        </td>
      </tr>
      </tal:block>
    </table>
  </tal:block>
  <br />
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td align="left" valign="top"
          tal:attributes="width python:str(100 / columns)+'%'"
          tal:repeat="batch_items batches">
          <metal:block
                use-macro="here/content_lib/macros/display_contents_column" />
      </td>
    </tr>
  </table>

  <tal:block condition="batch_string">
  <br />
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" width="100%">
          <span tal:replace="structure batch_string" />
        </td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
    </table>
  </tal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<pre>final display of items in a column using the given format:</pre>
<metal:block define-macro="display_contents_column">
  <tal:block define="no_form no_form|nothing;
                     format format|string:icon;
                     choosen_ids python:request.SESSION.get('choosen_ids', [])">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
    <tr valign="top" tal:repeat="item batch_items">
      <td tal:condition="not:no_form" align="left" valign="top" width="5">

        <input type="checkbox" name="ids:list" value="" id="" class="noborder"
               tal:condition="python:item.getId() not in choosen_ids"
               tal:attributes="value item/getId;
                               id python:'cb_'+item.getId()">
        <input type="checkbox" name="ids:list" value="" id="" checked
               tal:condition="python:item.getId() in choosen_ids"
               tal:attributes="value item/getId;
                               id python:'cb_'+item.getId()">
      </td>
      <td align="left" valign="top"
          tal:define="info python:here.getContentInfo(item, level=1)">
        <metal:block
          use-macro="python:path('here/content_lib/macros/info_%s' % format)" />
      </td>
    </tr>
  </table>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require tal:define="info getContentInfo(item)   -->


<!-- ============================================================ -->
<pre>status of a content:</pre>
<metal:block define-macro="status">
  <tal:block condition="not:status_short_fmt|nothing">
    <span i18n:translate="label_status">Label Status</span>
    <span tal:content="info/review_state" tal:attributes="class
      info/review_state" i18n:translate="">Work</span>
    <tal:block i18n:translate="">label_revision
      <span tal:content="info/rev" i18n:name="status_revision">1</span>
    </tal:block>
    <tal:block i18n:translate="">label_language
      <span tal:content="info/lang" i18n:name="status_language">en</span>
    </tal:block>
    <tal:block condition="status_time|nothing" i18n:translate="">label_since
      <span tal:content="info/stime" i18n:name="status_time">May28 pm</span>
    </tal:block>
  </tal:block>
  <tal:block condition="status_short_fmt|nothing" >
    <tal:block condition="status_time|nothing" i18n:translate="">
      <span tal:content="info/stime" i18n:name="status_time">May 6,...</span>:
    </tal:block>
    <span i18n:translate="">
      v<span tal:replace="info/rev" i18n:name="status_revision">1</span>- <span
      tal:replace="info/lang" i18n:name="status_language">en</span>
    </span>
    <span tal:content="info/review_state" tal:attributes="class
      info/review_state" i18n:translate="">published</span>
  </tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo level 1                  -->


<!-- ============================================================ -->
<pre>all doc information:</pre>
<metal:block define-macro="info_detail">
<div width="100%"
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
  <div tal:condition="info/preview|nothing" STYLE="float: right">
    <tal:block condition="info/preview|nothing"
      replace="structure python:here.getImgTag(info['preview'],
      base_url='', width='64', height='64')" />
  </div>
  <tal:block replace="structure python:here.getImgTag(info['icon'],
   base_url=base_url, title=info['type'])" />
   <a href="" tal:attributes="href string:/${info/rpath}/${action};">
   <b><span tal:replace="info/title_or_id">ID</span></b></a>
  <br>
  <a href="" tal:attributes="href string:/${info/rpath}/${action}">
  <small>
    <span tal:replace="string:id:${info/id}">[id]</span>,
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <tal:block condition="info/size|nothing">, <span tal:replace="info/size">
      10 kB</span>
    </tal:block>
  </small>
  </a>
  <tal:block condition="info/description">
    <br><small tal:content="info/description">Description</small>
  </tal:block>
</div>
</metal:block>

<!-- ============================================================ -->
<pre>iconic doc information:</pre>
<metal:block define-macro="info_icon">
<div width="100%" align="center"
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
 <a href="" tal:attributes="href string:/${info/rpath}/${action};
   title info/description;">
  <tal:block condition="not:info/preview|nothing"
   replace="structure python:here.getImgTag(info['icon'],
   base_url=base_url, zoom=2, title=info['description'])" />
  <tal:block condition="info/preview|nothing"
   replace="structure python:here.getImgTag(info['preview'],
   base_url='', width='32', height='32', title=info['description'])" />
   <br>
   <b><span tal:replace="info/title_or_id">ID</span></b></a>
</div>
</metal:block>

<!-- ============================================================ -->
<pre>compact doc information:</pre>
<metal:block define-macro="info_compact">
<div width="100%" tal:define="action
  python:test(info['type'] in ('Section','Workspace'), 'folder_contents', 'view')">
 <tal:block replace="structure python:path('here/'+ info['icon'])" />
 <a href="" tal:attributes="href string:/${info/rpath}/${action};
   title info/description">
 <b><span tal:replace="info/title_or_id">ID</span></b></a><br>
 <small>
   <tal:block define="status_short_fmt not:nothing;
                      status_time not:nothing;">
     <metal:block use-macro="here/content_lib/macros/status" />
   </tal:block>
 </small>
</div>
</metal:block>


<!-- ============================================================ -->
<pre>all doc information + summary</pre>
<metal:block define-macro="info_summary">
<div width="100%"
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
  <h2>
    <tal:block replace="structure python:here.getImgTag(info['icon'],
       base_url=base_url, title=info['type'])" />
    <a href="" tal:attributes="href string:/${info/rpath}/${action};">
    <b tal:content="info/title_or_id">ID</b></a>
  </h2>
  <div tal:condition="info/preview|nothing"
    STYLE="float: left;margin: 1em; width:140; height:140;">
    <a href="" tal:attributes="href string:/${info/rpath}/${action}"
      tal:content="structure python:here.getImgTag(info['preview'],
      base_url='', width='128', height='128')" />
  </div>
  <div>
  <small style="float: right;">
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <tal:block condition="info/size|nothing">, <span tal:replace="info/size">
      10 kB</span>
    </tal:block>
  </small>
  <tal:block condition="info/description">
    <br><p tal:content="info/description">Description</p>
  </tal:block>
  <tal:block condition="info/summary|nothing">
    <p><q tal:content="info/summary">Summary</q></p>
  </tal:block>
  </div>
</div>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 2                        -->


<!-- ============================================================ -->
<pre>display authorized proxies states for a document</pre>
<metal:block define-macro="states">
<strong i18n:translate="">label_publication_states</strong><br>
<span tal:repeat="item info/states">
  <span tal:condition="python:item['review_state'] != 'work'">
    <tal:block define="info item;
                       status_time not:nothing;
                       status_short_fmt not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span i18n:translate="">label_in_section
      <a href="." tal:attributes="href string:${base_url}${item/rpath}/"
         tal:content="item/title" i18n:name="section_id">Section</a>
    </span><br>
  </span>
</span>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 3                        -->


<!-- ============================================================ -->
<pre>display authorized history of a document</pre>
<metal:block define-macro="history">
  <strong i18n:translate="label_reviewing_history">Reviewing history:</strong><br>

  <span tal:repeat="item info/history" >

  <span i18n:translate="">
    <span tal:content="item/stime"
          i18n:name="history_time">May 6, 2003 5:28 pm</span>:

    </span>
    <span tal:content="item/action" i18n:translate="">publish</span>

   <tal:block condition="item/has_dest|nothing" i18n:translate="">
    into <span i18n:name="history_dest">
         <a href="."
            tal:content="item/dest_title"
            tal:attributes="href string:${base_url}${item/dest_container}/">
            Foo Section
         </a>
         </span>
    </tal:block>

    <span i18n:translate="">
      by <span tal:replace="item/actor" i18n:name="history_actor">bob</span>:
      <em tal:content="item/comments|nothing" i18n:name="history_comments">
        Comments
      </em>
    </span>
    <br />
  </span>
</metal:block>
