<!-- nuxeo boxes macros -->
<!-- $Id$ -->


<!-- ============================================================ -->
<metal:block define-macro="basebox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title"
      i18n:translate=""
      tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
        ...
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_menu">
  <div class="tabs"
       tal:define="sections sections|ttool/sections;
                   workspaces workspaces|ttool/workspaces;
                   stree python:sections.getList(start_depth=0, stop_depth=1);
                   wtree python:workspaces.getList(start_depth=0, stop_depth=0)">

    <a href="" class="plain"
       tal:repeat="item wtree"
       tal:attributes="href string:${base_url}${item/rpath}/;
                       class python:context_url.endswith(item['rpath']) and 'selected' or default;
                       title item/title"
       tal:content="structure item/short_title">
       section title
    </a>

    <a href="" class="plain"
       tal:repeat="item stree"
       tal:attributes="href string:${base_url}${item/rpath}/;
                       class python:context_url.endswith(item['rpath']) and 'selected' or default;
                       title item/title"
       tal:content="structure item/short_title">
       section title
    </a>
  </div>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="basebox_logo">
  <a href="http://www.nuxeo.com/"
     tal:attributes="href string:${base_url}">
    <img height="43" width="173" border="0" src="logo_nuxeo.gif" class="logo"
         alt="Nuxeo Logo" title="Nuxeo Web Site"
         tal:attributes="src string:${base_url}logo_nuxeo.gif" />
  </a>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_search">
  <div class="searchBox">
    <form method="get" action="search"
        tal:attributes="action string:${base_url}search_form">
      <a href="search_form"
         tal:attributes="href string:${base_url}advanced_search_form"
         i18n:translate="link_advanced_search">
        Advanced search</a>
      <br>
      <input id="searchGadget" type="text" name="SearchableText" size="20"
             value="" tal:attributes="value request/SearchableText|nothing">
      <input class="context searchButton" type="submit" value="button_ok"
             i18n:attributes="value">
    </form>
  </div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_breadcrumbs">
  <div class="pathBar">
    <span i18n:translate="label_you_are_here">You are here:&nbsp;</span>
    <span tal:repeat="bc python:here.getBreadCrumbs(url=context_url, breadcrumb_set=getattr(request, 'breadcrumb_set', None))">
      <a href="/cps/id"
         tal:omit-tag="not:bc/url"
         tal:attributes="href bc/url;
                         title bc/longtitle"
         tal:content="bc/title">
         Title
      </a>
      <strong tal:condition="not:repeat/bc/end">&nbsp;&gt;&nbsp;</strong>
    </span>
  </div>
</metal:block>



<!-- ============================================================ -->
<metal:block define-macro="basebox_l10n_select">
   <tal:block replace="structure here/Localizer/changeLanguageForm" />
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="basebox_footer">
  <div class="footer">
    Nuxeo - 14, rue du Soleillet, 75020 Paris France
    <br/>
    Email : <a href="mailto:contact@nuxeo.com"> contact@nuxeo.com</a>
    - Tél: +33 (0)1 40 33 79 87 - Fax: +33 (0)1 43 58 14 15
  </div>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="basebox_display_settings" 
             tal:condition="python:request.get('change_display', '0') == '1'">

<form tal:attributes="
        action string:${here/absolute_url};
        method string:post;
        name   string:form">
  <table border="0" cellspacing="2" cellpadding="2" width="100%">
    <tr>
      <td align="center" bgcolor="#EEEEE">
        <strong>
          <span i18n:translate="legend_choose_display_order">
              Choose the display order
          </span>
        </strong>
      </td>
      <td align="left">
        <tal:block define="cps_cookie python:request.SESSION.get('cps_preferences', {});
                           cps_display_order python:cps_cookie.get('cps_display_order', None)">	  
          <select name="display_order">
	    <option i18n:translate="label_default" value="title" selected 
                    tal:condition="python:cps_display_order is None">
                    Default
            </option>
	    <option i18n:translate="label_default" value="title" 
                    tal:condition="python:cps_display_order is not None">
                    Default
            </option>
            <option i18n:translate="label_title" value="title" selected 
                    tal:condition="python:cps_display_order == 'title'">
                    Title
            </option>
	    <option i18n:translate="label_title" value="title" 
                    tal:condition="python:cps_display_order != 'title'">
                    Title
            </option>
	    <option i18n:translate="label_date" value="date" selected 
                    tal:condition="python:cps_display_order == 'date'">
                    Date
            </option>
	    <option i18n:translate="label_date" value="date" 
                    tal:condition="python:cps_display_order != 'date'">
                    Date
            </option>

	    <option i18n:translate="label_status" value="status" selected 
                    tal:condition="python:cps_display_order == 'status'">
                    Status
            </option>
	    <option i18n:translate="label_status" value="status" 
                    tal:condition="python:cps_display_order != 'status'">
                    Status
            </option>
          </select>
        </tal:block>
      </td>
    </tr>
    <tr>
      <td align="center">
        <strong>
          <span i18n:translate="legend_choose_display_style">
              Choose the display style
          </span>
        </strong>
      </td>
      <td align="left">
        <tal:block define="cps_cookie python:request.SESSION.get('cps_preferences', {});
                           cps_display_style python:cps_cookie.get('cps_display_style', None)">	  
           <select name="display_style"> 
	     <option i18n:translate="label_default" value="compact" selected
	             tal:condition="python:cps_display_style == None">    
                     Default
	     </option>
	     <option i18n:translate="label_default" value="compact" 
	             tal:condition="python:cps_display_style != None"> 
                     Default
	     </option>
             <option i18n:translate="label_icons" value="icon" selected
	             tal:condition="python:cps_display_style == 'icon'">
                     Icon
             </option>
	     <option i18n:translate="label_icons" value="icon" 
	             tal:condition="python:cps_display_style != 'icon'">
                     Icon
             </option>
	     <option i18n:translate="label_detailed" value="detail" selected
                     tal:condition="python:cps_display_style == 'detail'">
                     Detail
             </option>
	     <option i18n:translate="label_detailed" value="detail" 
                     tal:condition="python:cps_display_style != 'detail'">
                     Detail
             </option>
	     <option i18n:translate="label_compact" value="compact" selected
                     tal:condition="python:cps_display_style == 'compact'">
                     Compact
             </option>
	     <option i18n:translate="label_compact" value="compact" 
                     tal:condition="python:cps_display_style != 'compact'">
                     Compact
             </option>
           </select>
        </tal:block>
      </td>
    </tr>
    <tr>
      <td>&nbsp;</td>
      <td align="right" colspan="1">
        <input type="hidden" name="change_display" 
               tal:attributes="value python:request.get('change_display', 0)" />
        <input type="submit" value="Change" tal:attributes="name string:changeListingDisplay:method" />
        <input type="submit" value="Invert" tal:attributes="name string:changeListingDirection:method" />
      </td>
    </tr>
  </table>
</form>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="textbox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title"
      i18n:translate=""
      tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd"
           tal:content="structure box/box/text">
        box text body
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_default">
  <metal:block use-macro="here/box_lib/macros/sbox">
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
       <tal:block define="
          no_form not:nothing;
          items python:box['box'].getFolderContents(here);
          format string:compact;
          columns python:1;
          items_per_page python:10;
          nav_action string:folder_view">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
        </tal:block>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_center"
  tal:define="items python:box['box'].getFolderContents(here)">
  <tal:block condition="python:len(items)>0">
  <metal:block use-macro="here/box_lib/macros/sbox">
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
       <tal:block define="
          no_form not:nothing;
          format string:detail;
          columns python:1;
          items_per_page python:10;
          nav_action string:folder_view">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
        </tal:block>
      </div>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="treebox_default">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <div class="content odd">
        <span tal:repeat="item python:box['box'].getTree(here)">
          <span tal:replace="structure python:'&nbsp;'*4*item['depth']">&nbsp;</span><a href="." tal:attributes="class python:context_url.endswith(item['rpath']) and 'selected' or default;
                                 href string:${base_url}${item/rpath}/;"><span tal:replace="structure string:${item/short_title}">id</span></a><span tal:condition="item/nb_children" tal:replace="string:*" /><br/>
        </span>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_center"
  tal:define="items python:box['box'].getTree(here);">

 <tal:block condition="python: len(items)>0">
   <tal:block define="root python:items[0];
                      depth python:root['depth']+1;
                      items python:items[1:];
                      nb_item python:len(items);
                      global treenb_row  python:nb_item/2+2;">
      <table width="100%">
	<tr><td valign="top" width="50%">
        <tal:block repeat="item items">
          <tal:block condition="python:item['depth']==depth">
          <br tal:condition="not:repeat/item/start" />
	  <tal:block condition="python:repeat['item'].number() >= treenb_row">
            <tal:block replace='structure string:</td><td width="50%" valign="top">'
	      define="global treenb_row python:nb_item + 1"/>
	  </tal:block>



        <tal:block define="global last_child python: repeat['item'].number() + item['nb_children']" />
<b><a href="." tal:attributes="href string:${base_url}${item/rpath}/" ><img src="" alt="[Link]" border="0"
      tal:attributes="src string:${base_url}folder_icon.gif" />&nbsp;<span tal:replace="structure string:${item/title_or_id}">title</span></a></b><span tal:condition="item/nb_children" tal:replace="string::" /><br/>
          </tal:block>
          <tal:block condition="python:item['depth']>depth">
<a href="." tal:attributes="href string:${base_url}${item/rpath}/"><span tal:replace="structure string:${item/title_or_id}">title</span></a><span tal:condition="item/nb_children" tal:replace="string:..." /><span tal:condition="python: repeat['item'].number() != last_child">,&nbsp;</span><span tal:condition="python: repeat['item'].number() == last_child">.<br/></span>
          </tal:block>

        </tal:block>
	</td></tr></table>
   </tal:block>
 </tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_default"
  tal:define="items python:box['box'].getActions(here, actions)">
  <tal:block condition="python:filter(None, items)">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" i18n:translate="" tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <tal:block repeat="category items">
      <div tal:attributes="class python:'content '+ test(repeat['category'].odd(), 'even', 'odd')">
        <ul>
          <li tal:repeat="action category">
            <a i18n:translate="" tal:attributes="href action/url"
               tal:content="action/name">
	      Action
             </a>
          </li>
        </ul>
      </div>
      </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_user"
  tal:define="items python:box['box'].getActions(here, actions)">
  <tal:block condition="python:len(items)">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title">
      <tal:block define="
                         mtool here/portal_membership;
                         url nocall:here/portal_url;
                         dtool here/portal_metadirectories;
			 dirname string:members;
			 directory dtool/?dirname;
                         entry python:directory.getEntry(uname);
                        ">

         <tal:block define="notLogged python:mtool.isAnonymousUser()">
           <span tal:condition="notLogged"
	         i18n:translate="label_guest"
                 tal:content="uname">
              box text title
           </span>
           <a href="."
              tal:condition="python:notLogged == 0 and entry is not  None"
              tal:attributes="href string:${here/portal_url}/workspaces/members/${uname}"
              tal:content="python:entry.get('fullname', uname)" >
              box text title
           </a>
	   <a href="."
              tal:condition="python:notLogged == 0 and entry is None"
              tal:attributes="href string:${here/portal_url}/workspaces/members/${uname}"
              tal:content="uname" >
              box text title
           </a>
         </tal:block>
      </tal:block>
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized" fill-slot="box_body">
      <tal:block repeat="category items">
      <div tal:attributes="class python:'content '+ test(repeat['category'].odd(), 'even', 'odd')">
        <ul>
          <li tal:repeat="action category">
            <a tal:attributes="href action/url"
               i18n:translate=""
               tal:content="action/name">
               Action
             </a>
          </li>
        </ul>
      </div>
      </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>
