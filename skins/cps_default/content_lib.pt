<!-- macro library for contents -->
<!-- $Id$ -->

<!-- ============================================================ -->
<pre>a master macro used for content stuff:</pre>
<metal:block define-macro="master">
<tal:block define="proxy here/this;
                   doc here/getContent;
                   ">
<metal:block use-macro="here/main_template/macros/master">

<metal:block fill-slot="base">
  <tal:block define="rpath python:utool.getRelativeContentURL(here)" replace="structure string:<!--
cps test / debug information:
cps:path:${here/absolute_url}
cps:rpath:${rpath}
cps:proxy_id:${proxy/id}
cps:id:${doc/id}
-->" />
  <metal:block define-slot="base" />
</metal:block>

<metal:block fill-slot="header">
  <metal:block define-slot="header">
    <h1 id="DesktopTitle"
        tal:content="here/title_or_id"> Page Title </h1>
    <div id="DesktopDescription"><span tal:content="doc/Description" /><br/>
    </div>
  </metal:block>
</metal:block>

<metal:block fill-slot="main">
  <metal:block define-slot="main" />
</metal:block>

</metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a std formated main:</pre>
<metal:block define-macro="std_main">
  <div class="Desktop">
    <h1><metal:block define-slot="title">title</metal:block></h1>
    <em><metal:block define-slot="help">help</metal:block></em><br/><br/>
    <div metal:define-slot="main" i18n:domain="cmf_default">
       main bla
    </div>
  </div>
</metal:block>


<!-- ============================================================ -->
<pre>form used for state transition:</pre>
<metal:block define-macro="transition_form">
<form method="post" action="content_status_modify"
  tal:attributes="action string:${proxy/absolute_url}/content_status_modify">
  <div metal:define-slot="fields">
   <!-- more fields -->
  </div>
  <strong><em i18n:translate="">Comments</em></strong><br/>
  <textarea name="comment" cols="60" rows="5" wrap="soft" style="width: 100%"></textarea>
  <div metal:define-slot="button">
    <input type="hidden" name="workflow_action" value="transition" />
    <input type="submit" value="Transition" i18n:attributes="value" />
  </div>
</form>
</metal:block>


<!-- ============================================================ -->
<pre>list contents in 'items' detail:</pre>
<metal:block define-macro="display_contents">
  <tal:block define="nav_action nav_action|string:'folder_contents';
                     b_start request/b_start | python:0;
                     Batch nocall: modules/ZTUtils/Batch;
                     batch1 python:Batch(items, 10, int(b_start), orphan=0);
                     format string:info_detail">
  <table width="100%">
    <tr><td colspan="2">
      <tal:block define="batch_items batch1;">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>
    </td></tr>
    <tr><td align="left" nowrap>
      <span tal:define="p batch1/previous" tal:condition="p">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${p/previous/first}" i18n:translate="">Previous Items</a>
       </span>
    </td><td align="right" nowrap>
      <span tal:define="n batch1/next | nothing" tal:condition="n">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${batch1/end}" i18n:translate="">Next Items</a>
      </span>
    </td></tr>
  </table>
  </tal:block>
</metal:block>

  
<!-- ============================================================ -->
<pre>list contents in 'items' compact:</pre>
<metal:block define-macro="display_contents_compact">
  <tal:block define="nav_action nav_action|string:'folder_contents';
                     b_start request/b_start | python:0;
                     Batch nocall: modules/ZTUtils/Batch;
                     batch1 python:Batch( items, 5, int(b_start), orphan=0);
                     batch2 batch1/next;
                     format string:info_compact">
  <table width="100%">
    <tr><td>
      <tal:block define="batch_items batch1">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>
    </td><td>
      <tal:block define="batch_items batch2">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>
    </td></tr>
    <tr><td align="left" nowrap>
      <span tal:define="p batch1/previous" tal:condition="p">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${p/previous/first}" i18n:translate="">Previous Items</a>
       </span>
    </td><td align="right" colspan="2" nowrap>
      <span tal:define="n batch2/next | nothing" tal:condition="n">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${batch2/end}" i18n:translate="">Next Items</a>
      </span>
    </td></tr>
  </table>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<pre>list contents in 'items' with icon</pre>
<metal:block define-macro="display_contents_icon">
  <tal:block define="nav_action nav_action|string:'folder_contents';
                     b_start request/b_start | python:0;
                     Batch nocall: modules/ZTUtils/Batch;
                     batch1 python:Batch( items, 5, int(b_start), orphan=0);
                     batch2 batch1/next;
                     batch3 batch2/next|batch1/next;
                     format string:info_icon">
  <table width="100%">
    <tr><td>
      <tal:block define="batch_items batch1">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>
    </td><td>
      <tal:block define="batch_items batch2">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>
    </td><td>
      <tal:block define="batch_items batch3">
        <metal:block use-macro="here/content_lib/macros/display_contents_column"/>
      </tal:block>      
    </td></tr>
    <tr><td align="left" nowrap>
      <span tal:define="p batch1/previous" tal:condition="p">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${p/previous/first}" i18n:translate="">Previous Items</a>
       </span>
    </td><td align="right" colspan="2" nowrap>
      <span tal:define="n batch3/next | nothing" tal:condition="n">
        <a href="" tal:attributes="href string:${nav_action}?b_start=${batch1/end}" i18n:translate="">Next Items</a>
      </span>
    </td></tr>
  </table>
  </tal:block>
</metal:block>


  
<!-- ============================================================ -->
<pre>list contents in 'batch_items' in a column:</pre>
<metal:block define-macro="display_contents_column">
  <tal:block define="no_form no_form|nothing;
                     format format|string:info_detail;">
  <table width="100%">
  <tr valign="top" tal:repeat="item batch_items">
    <td align="left" width="5">
      <input type="checkbox" name="ids:list" value="" id=""
             tal:condition="not:no_form"
             tal:attributes="value item/getId;
                             id python:'cb_'+item.getId()" />
    </td>
    <td>
      <span tal:define="info python:here.getContentInfo(item, level=1);">
        <metal:block use-macro="python:path('here/content_lib/macros/%s' % format)" />
      </span>
    </td>
  </tr>
  </table>
  </tal:block>
</metal:block>

  
  
<!-- ============================================================ -->
<!-- below macros require tal:define="info getContentInfo(item)   -->


<!-- ============================================================ -->
<pre>status of a content:</pre>
<metal:block define-macro="status">
<tal:block condition="not:status_short_fmt|nothing">
  <strong i18n:translate="">Status: </strong>
  <span tal:replace="info/review_state">Work</span>
  <strong i18n:translate="">Revision: </strong>
  <span tal:replace="info/rev">1</span>
  <strong i18n:translate="">Language: </strong>
  <span tal:replace="info/lang">en</span>
  <tal:block condition="status_time|nothing">
    <strong i18n:translate="">Since: </strong>
    <span tal:replace="info/stime">May 6, 2003 5:28 pm</span>
  </tal:block>
</tal:block>
<tal:block condition="status_short_fmt|nothing">
  <tal:block condition="status_time|nothing">
    <span tal:replace="info/stime">May 6, 2003 5:28 pm</span>:
  </tal:block>
  v<span tal:replace="info/rev">1</span>-<span tal:replace="info/lang">en</span>
  <span tal:replace="info/review_state">published</span>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo level 1                  -->


<!-- ============================================================ -->
<pre>all doc information in a table:</pre>
<metal:block define-macro="info_detail">
<table cellspacing="0" cellpadding="0" width="100%"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EEEEEE' or nothing">
  <tr><td width="20">
   <img src="" border="0"
     tal:attributes="src string:${here/portal_url}/${info/icon};
                     title info/type;"/>
  </td><td>
   <a href="" tal:attributes="href string:${info/id}/view;">
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
  </td></tr>
  <tr><td colspan="2" nowrap>
  <a href="" tal:attributes="href string:${info/id}/view;">
  <small>
    <span tal:replace="string:id:${info/id}">[id]</span>,
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span tal:replace="info/size|nothing">10 kB</span> 
  </small>
  </a>
  </td></tr>
  <tr tal:condition="info/description"><td colspan="2">
    <small><em><span tal:replace="info/description">Description</span></em></small>
  </td></tr>
</table>
</metal:block>

<!-- ============================================================ -->
<pre>iconic doc information in a table:</pre>
<metal:block define-macro="info_icon">
<table cellspacing="0" cellpadding="0" width="100"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EEEEEE' or nothing">
  <tr><td align="center">
   <a href="" tal:attributes="href string:${info/id}/view;
                              title info/description;">
    <img src="" border="0" width="30" length="40"
     tal:attributes="src string:${here/portal_url}/${info/icon};"/></a>
  </td></tr>
  <tr><td align="center">
   <a href="" tal:attributes="href string:${info/id}/view;"
      title="info/description">
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
  </td></tr>
</table>
</metal:block>

<!-- ============================================================ -->
<pre>short doc information in a table:</pre>
<metal:block define-macro="info_compact">
<table cellspacing="0" cellpadding="0" width="100%"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EEEEEE' or nothing">
  <tr><td width="20">
   <img src="" border="0"
     tal:attributes="src string:${here/portal_url}/${info/icon};
                     title info/type;"/>
  </td><td>
   <a href="" tal:attributes="href string:${info/id}/view;
                              title info/description">
     <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
   <small>
    <span tal:replace="string:id:${info/id}">[id]</span>,
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
   </small>
  </td></tr>
</table>
</metal:block>



<!-- ============================================================ -->
<!-- below macros require getContentInfo 2                        -->


<!-- ============================================================ -->
<pre>display authorized proxies states for a document</pre>
<metal:block define-macro="states">
<strong i18n:translate="">Publication states: </strong><br/>
<span tal:repeat="item info/states">
  <span tal:condition="python:item['review_state'] != 'work'">
    <tal:block define="info item;
                       status_time not:nothing;
                       status_short_fmt not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span i18n:translate="">in section: </span>
    <a href="." tal:attributes="href string:${portal_url}/${item/rpath}/">
      <span tal:replace="item/title">Section</span></a>
    <br/>
  </span>
</span>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 3                        -->


<!-- ============================================================ -->
<pre>display authorized history of a document</pre>
<metal:block define-macro="history">
<strong i18n:translate="">Reviewing history:</strong><br/>
<span tal:repeat="item info/history">
  <span tal:replace="item/stime">May 6, 2003 5:28 pm</span>:
  <span tal:replace="item/action">publish</span>
  <span tal:omit-tag="" i18n:translate="">by
  <span tal:replace="item/actor" i18n:name="actor">bob</span>:</span>
  <em tal:condition="item/comments"><span tal:replace="item/comments">Comments</span></em>
  <br/>
</span>
</metal:block>

