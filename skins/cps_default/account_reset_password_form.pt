<html xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  metal:use-macro="here/main_template/macros/master">

  <body>
    <metal:block metal:fill-slot="main"
      tal:define="
      reset_token python:request.get('reset_token');
      username python:request.get('username');
      membership_tool here/portal_membership;
      valid_reset_token python:
      membership_tool.isPasswordResetRequestValid(reset_token, username);
      "
      >
      <h1 i18n:translate="heading_enter_your_new_password">Enter your new password</h1>

      <tal:block condition="valid_reset_token">
        <form action="register" method="post"
          tal:attributes="action string:${here/portal_url}/reset_password">

          <dl class="form">
            <dt><label for="password"
                i18n:translate="label_password">Password</label></dt>
            <dd>&#160;<input type="password" id="password" name="password" size="30"
                value=""
                tal:attributes="value request/password|nothing" /></dd>
            <dt><label for="confirm"
                i18n:translate="label_password_confirm">Password
                (confirm)</label></dt>
            <dd>&#160;<input type="password" id="confirm" name="confirm" size="30" value=""
                tal:attributes="value request/confirm|nothing" /></dd>
          </dl>

          <p class="buttonArea">
            <input i18n:attributes="value" class="standalone"
              type="submit" name="submit" value="button_save_new_password" />
          </p>

        </form>
      </tal:block>
      <tal:block condition="not:valid_reset_token">
        <p i18n:translate="help_invalid_reset_password_request">
          Your password reset request is invalid.
          May be you would like to try again.
        </p>
      </tal:block>

    </metal:block>
  </body>
</html>
