<!-- nuxeo boxes macros -->
<!-- $Id$ -->
<!-- ============================================================ -->
<metal:block define-macro="basebox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title">A test box</metal:block>
    <metal:block fill-slot="box_body">Box body.</metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_hr_separator">
<hr />
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="basebox_br_separator">
<br />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_menu">
<ul class="menu"
    tal:define="sections sections|ttool/sections;
                stree python:sections.getList(stop_depth=1);
                workspaces workspaces|ttool/workspaces;
                wtree python:workspaces.getList(stop_depth=2)[:1]"
    tal:condition="python:stree or wtree">
  <li tal:repeat="item stree"
      tal:omit-tag="item/hidden_folder|nothing"
      tal:attributes="class python:context_url.endswith(item['rpath']) and (
        'selected') or nothing"><a href=""
      tal:condition="not:item/hidden_folder|python:1"
      tal:attributes="href string:${base_url}${item/rpath}/;
                      title item/title"
      tal:content="structure item/short_title">
    Section title</a></li>
  <li class="workspace"
      tal:repeat="item wtree"
      tal:omit-tag="item/hidden_folder|nothing"
      tal:attributes="class python:context_url.endswith(item['rpath']) and (
        'selected workspace') or 'workspace'"><a href=""
      tal:condition="not:item/hidden_folder|python:1"
      tal:attributes="href string:${base_url}${item/rpath}/;
                      title item/title"
      tal:content="structure item/short_title">
    Workspace title</a></li>
</ul>
<br style="clear: both;" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_logo">
<a href="http://www.cps-project.org/"
   tal:attributes="href string:${base_url}">
  <img height="52" width="170" src="logo_cps.png" class="logo"
    alt="CPS Logo" title="Home"
    tal:attributes="src string:${base_url}logo_cps.png" />
</a><br class="netscape4" />
<br class="netscape4" /><br class="netscape4" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_search">
  <div class="searchBox">
    <form method="get" action="search_form"
      onsubmit="return checkEmptySearch(this)"
      tal:define="sfpo_id string:box">
      <p>
        <label for="searchGadget"
          i18n:translate="label_text_to_search">Text to search</label>
        <input id="searchGadget" type="text" name="SearchableText" size="20"
          value="" tal:attributes="value request/SearchableText|nothing" />
        <input class="context searchButton" type="submit" value="button_search"
          i18n:attributes="value" /><br />
        <metal:block
          use-macro="here/generic_lib_search_folder_prefix_option/macros/search_folder_prefix_option" />
      </p>
    </form>
  </div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_breadcrumbs">
<hr class="netscape4" />
<div class="pathBar">
<metal:block use-macro="here/generic_lib_breadcrumbs/macros/breadcrumbs" />
</div>
<hr class="netscape4" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_folder_header"
  tal:define="doc nocall:doc|python:here.getContent()">
<div class="doNotPrint"
  tal:condition="python: checkPerm('List folder contents', here, 'aq_parent')">
  <a href="../">
  <img tal:replace="structure python:here.getImgTag('UpFolder_icon.png',
    base_url=base_url)" />
  <span i18n:translate="">description_up_to
    <strong i18n:name="up_id" tal:content="python:here.aq_parent.title_or_id()">
      Up ID</strong>
  </span>
  </a>
</div>
<tal:block tal:define="languages here/getProxyLanguages"
  tal:condition="python:len(languages) > 1">
  <div class="documentActions" tal:define="current_lang doc/Language">
  <ul><tal:block repeat="lang languages"><tal:block
    define="selected_lang python:current_lang == lang">
    <tal:block condition="selected_lang">
      <li><span class="selectedLang" tal:content="lang">en</span></li>
    </tal:block>
    <tal:block condition="not:selected_lang">
      <li><a tal:content="lang" class="availableLang"
         tal:attributes="href string:${context_url}/switchLanguage/${lang};
                         title string:To the '${lang}' translation">fr</a></li>
    </tal:block>
  </tal:block></tal:block></ul>
  </div>
</tal:block>
<h1 tal:content="here/title_or_id">Page Title</h1>

<div class="description" tal:condition="doc/Description|nothing"
  tal:content="doc/Description">description</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_l10n_select"
   tal:define="map here/Localizer/get_languages_map;
               languages python: [lang['id'] for lang in map];
               selected_language here/Localizer/get_selected_language;
               l10n_translated nothing;"
   tal:condition="python:len(map) > 1">
<form id="idioma" method="post"
      tal:attributes="action string:${base_url}changeCPSLanguage"
      tal:define="lang_voc here/portal_vocabularies/language_voc">
  <p>
  <label for="languageChooser"
         i18n:translate="label_language">Language</label><br />
  <select name="lang" id="languageChooser"
    onchange="var elt = document.getElementById('idioma'); if (elt) {elt.submit()}">
    <tal:block condition="not:l10n_translated"
               repeat="language python:lang_voc.keysSortedBy('label')">
    <option tal:condition="python:language in languages"
            tal:attributes="value language;
                            selected python:test(language==selected_language,'selected', nothing);"
            tal:content="python:lang_voc.get(language)">
      Language</option>
    </tal:block>
    <tal:block condition="l10n_translated"
               repeat="language python:lang_voc.keysSortedBy('label')">
    <option tal:condition="python:language in languages"
            tal:attributes="value language;
                            selected python:test(language==selected_language,'selected', nothing);"
            tal:content="python:lang_voc.getMsgid(language)"
            i18n:translate="">
      Language</option>
    </tal:block>
  </select>
  <input type="submit" value="button_ok" i18n:attributes="value" />
  </p>
</form>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_conformance_statement">
<hr class="netscape4" />
<ul class="conformanceStatement doNotPrint">
  <li>
    <a href="http://www.cps-project.org/">
      <img src="cps-minibanner.png"
        width="80" height="15"
        alt="label_advertisement_use_cps"
        title="label_advertisement_use_cps"
        tal:attributes="src string:${base_url}cps-minibanner.png"
        i18n:attributes="alt title"/></a>
  </li>
  <li>
    <a href="http://validator.w3.org/check/referer">
      <img src="valid-xhtml10.png"
        width="80" height="15"
        alt="Valid XHTML 1.0"
        title="label_conformance_valid_xhtml"
        tal:attributes="src string:${base_url}valid-xhtml10.png"
        i18n:attributes="title"/></a>
  </li>
  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer">
      <img src="valid-css.png"
        width="80" height="15"
        alt="Valid CSS"
        title="label_conformance_valid_css"
        tal:attributes="src string:${base_url}valid-css.png"
        i18n:attributes="title"/></a>
  </li>
  <li>
    <a href="http://www.w3.org/WAI/WCAG1A-Conformance">
      <img src="wcag1A.png"
        width="80" height="15"
        alt="W3C Web Content Accessibility Level A conformance"
        title="label_conformance_wai_1a"
        tal:attributes="src string:${base_url}wcag1A.png"
        i18n:attributes="title"/></a>
  </li>
</ul>
<hr class="netscape4" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="eventcalendarbox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
                 tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block fill-slot="box_body">
    <div class="CalendarBox"
         tal:define="DateTime python:modules['DateTime'].DateTime;
                     yearmonth python:here.getMonthAndYear();
                     year python:yearmonth[0];
                     month python:yearmonth[1];
                     location box/box/events_in|nothing;
                     event_types python:box['box'].event_types or [];
                     weeks python:here.portal_calendar.getCPSEventsForCalendar(
                           month=month, year=year, location=location,
                           event_types=event_types);">

      <table cellpadding="0" cellspacing="0" border="0"
        summary="calendar layout">
      <tr><td>
        <table cellpadding="2" cellspacing="0" border="0" class="calendar"
          summary="calendar layout">
          <tr>
            <th>
              <a href="#" class="CalendarArrow"
                 tal:attributes="href python:here.getPreviousMonthLink(
                                             request.URL0, month, year)">
               &#171;
              </a>
            </th>
            <th colspan="5" tal:define="date string:$month/1/$year">
              <span tal:replace="
                  python:cpsmcat('calendar_month_%s' % month)"/>
              <span tal:replace="python:DateTime(date).year()"/>
            </th>
            <th>
              <a href="#" class="CalendarArrow"
                 tal:attributes="href python:here.getNextMonthLink(
                                             request.URL0, month, year)">
               &#187;
              </a>
            </th>
          </tr>
          <tr tal:define="weekdays python:here.portal_calendar.getDayList(here.Localizer)">
            <tal:weekday tal:repeat="weekday weekdays">
              <td class="weekdays" tal:content="python:cpsmcat('calendar_day_%s' % weekday)">Su</td>
            </tal:weekday>
          </tr>
          <tr tal:repeat="week weeks">
            <tal:week tal:define="days week">
              <tal:day tal:repeat="day days">
                <tal:daynumber tal:define="daynumber day/day;
                                           datestring python:'%d/%0.2d/%0.2d' %
                                           (year, month, daynumber);">
                  <tal:block tal:condition="day/event">
                    <td class="event"
                        tal:attributes="class python:here.getDaysClass(
                                        daynumber, month, year, day['event'])">
                      <a href=""
                         tal:attributes="href python:here.getCalCPSDayViewParams(
                                                      context_url=context_url,
                                                      datestring=datestring,
                                                      location=location,
                                                      event_types=event_types)"
                         tal:content="python: daynumber or default">
                      </a>
                    </td>
                  </tal:block>
                  <tal:block tal:condition="not: day/event">
                    <td tal:content="python: daynumber or default"
                        tal:attributes="class python:here.getDaysClass(
                                        daynumber, month, year)">
                    </td>
                  </tal:block>
                </tal:daynumber>
              </tal:day>
            </tal:week>
          </tr>
        </table>
      </td></tr>
      </table>
    </div>
    </metal:block>
  </metal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="textbox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>

    <metal:block fill-slot="box_body"
                 tal:define="i18n python:box['box'].getI18n()">
      <tal:block condition="i18n" i18n:translate=""
                 content="structure box/box/text">box text body</tal:block>
      <tal:block condition="not:i18n"
                 content="structure box/box/text">box text body</tal:block>
    </metal:block>

  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_default"
  tal:define="ret python:box['box'].getContents(here);
              items python:ret[0];
              link_more python:ret[1];"
  tal:condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>
    <metal:block fill-slot="box_body">
       <tal:block define="
          no_form python:1;
          filter python:0;
          format box/box/display;
          items_per_page box/box/nb_items|python:10;
          nav_action string:folder_view;
          zoom box/box/zoom;">
          <metal:block use-macro="here/content_lib_display_contents/macros/display_contents" />
       </tal:block>
       <div tal:condition="link_more">
         <a href="" tal:attributes="href link_more"
           i18n:translate="link_more">More...</a>
       </div>
      <metal:block use-macro="here/xml_exports/macros/rss_atom_exports"/>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_last_modified">
  <metal:block use-macro="here/boxes_nuxeo/macros/contentbox_default" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_pending">
  <metal:block use-macro="here/boxes_nuxeo/macros/contentbox_default" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_simple"
  tal:define="ret python:box['box'].getContents(here);
              items python:ret[0];
              link_more python:ret[1];"
  tal:condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>

    <metal:block fill-slot="box_body">
      <div style="padding-bottom: 6px;"
         tal:repeat="item items">
        <tal:block define="info python:here.getContentInfo(item, level=1);
                           start repeat/item/start|nothing;
                           end repeat/item/end|nothing">
          <metal:block use-macro="here/content_lib_info_simple/macros/info_simple" />
        </tal:block>
       </div>
       <div tal:condition="link_more">
         <a href="" tal:attributes="href link_more"
           i18n:translate="link_more">More...</a>
       </div>
      <metal:block use-macro="here/xml_exports/macros/rss_atom_exports"/>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_default"
  tal:define="items python:box['box'].getTree(here);">
<tal:block condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title" i18n:translate="">
       box text title
    </metal:block>
    <metal:block fill-slot="box_body">
      <tal:block repeat="item items">
        <div style="white-space:nowrap">
          <span tal:replace="structure python:'&nbsp;'*4*item['depth']"> </span>
          <img tal:condition="python:getattr(box['box'],'display_icons',0)"
               tal:replace="structure
                              python:
                                here.getImgTag(here.portal_types[item['portal_type']].getIcon(),
                                               base_url=base_url)" />
          <tal:block>
            <tal:block tal:condition="item/visible">
              <a href="."
                 tal:attributes="class python:test(context_url.endswith(
                                             item['rpath']),'selected', default);
                                 href string:${base_url}${item/rpath}/;
                                 title item/title;"
                 tal:content="structure string:${item/short_title}">
              </a><tal:block tal:condition="item/nb_children" tal:replace="string:*" />
            </tal:block>
            <tal:block tal:condition="not: item/visible"
                       tal:content="structure python:item['short_title'] +
                                                     test(item['nb_children'],
                                                          '*','')" />
            </tal:block>
          <tal:block tal:condition="python:getattr(box['box'],'display_managers',0)">
            <tal:block tal:define="managers python:item['managers']"
                       tal:condition="managers">
              - [
              <tal:block tal:define="mdir here/portal_directories/members;
                                     mdir_id mdir/getId"
                         tal:repeat="manager managers">
                <tal:block tal:define="user python:mdir.getEntry(manager, default=None)"
                           tal:condition="user">
                  <a style="font-style:italic" href=""
                     tal:content="python:user.get('fullname', manager)"
                     tal:attributes="href
                       python:'%scpsdirectory_entry_view?dirname=%s&amp;id=%s' %
                        (base_url, mdir_id, manager)"></a>
                  <tal:block tal:condition="not:repeat/manager/end">,</tal:block>
                </tal:block>
              </tal:block>]
            </tal:block>
          </tal:block>
        </div>
        <div style="white-space:normal"
             tal:condition="python:getattr(box['box'],'display_description',0)">
          <tal:block tal:define="description python:item['description']"
                     tal:condition="description">
            <span tal:replace="structure
                               python:'&nbsp;'*4*(item['depth']+1)"> </span>
            <span tal:replace="description" />
          </tal:block>
        </div>
      </tal:block>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_center"
  tal:define="items python:box['box'].getTree(here);">
<tal:block condition="python: len(items)>1">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="here/title_or_id">Page Title
    </metal:block>
    <metal:block fill-slot="box_body">
    <tal:block define="root python:items[0];
                       depth python:root['depth']+1;
                       items python:items[1:];
                       nb_item python:len(items);
                       global treenb_row python:nb_item/2+2;
                       ttool here/portal_types;">
    <table width="100%" summary="treebox layout"
           tal:define="disp_icons python:getattr(box['box'],'display_icons',0)">
        <tr><td valign="top" width="50%">
        <tal:block repeat="item items">
          <tal:block condition="python:item['depth'] == depth">
          <tal:block condition="not:python:ttool[getattr(here,
               item['id']).portal_type].cps_display_as_document_in_listing">
          <tal:block condition="not:repeat/item/start"><br /><br /></tal:block>
          <tal:block condition="python:repeat['item'].number() >= treenb_row">
            <tal:block define="global treenb_row python:nb_item + 1"
                 replace="structure string:&lt;/td>&lt;td width='50%' valign='top'>"/>
          </tal:block>
<a href="." tal:attributes="href string:${base_url}${item/rpath}/" ><strong>
          <img tal:condition="disp_icons"
               tal:replace="structure
                              python:
                                here.getImgTag(here.portal_types[item['portal_type']].getIcon(),
                                               base_url=base_url)" />
          <span tal:replace="structure string:${item/title_or_id}">
            title
          </span></strong></a>
          <tal:block condition="item/nb_children"
             tal:define="global last_child python: repeat['item'].number() +
               item['nb_children']">:<br /></tal:block>
          </tal:block>
          </tal:block>
          <tal:block condition="python:item['depth']>depth">
          <a href="." tal:attributes="href string:${base_url}${item/rpath}/">
          <span tal:replace="structure string:${item/title_or_id}">
          title</span></a><span
          tal:condition="item/nb_children" tal:replace="string:..." /><span
          tal:condition="python: repeat['item'].number() != last_child"
          >,</span><span tal:condition="python: repeat['item'].number() == last_child">.</span>
          </tal:block>
        </tal:block>
        </td></tr></table><br />
   </tal:block>
   </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_sitemap"
             tal:define="items python:box['box'].getTree(here);">
<tal:block condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title" i18n:translate="">
       box text title
    </metal:block>
    <metal:block fill-slot="box_body">
      <tal:block tal:define="global last_depth python:-1">
        <tal:block tal:repeat="item items">
          <tal:block tal:define="delta_depth python:item['depth'] - last_depth;
                                 display_managers python:getattr(box['box'],
                                                           'display_managers',
                                                           0)">
            <tal:block tal:condition="python:delta_depth > 0"
                       tal:replace="structure string:&lt;dl>" />
            <tal:block tal:condition="python:delta_depth &lt; 0">
              <tal:block tal:replace="structure string:&lt;/dd>" />
              <tal:block tal:repeat="i python:range(0,-delta_depth)">
                <tal:block tal:replace="structure string:&lt;/dl>&lt;/dd>"/>
              </tal:block>
            </tal:block>
            <tal:block tal:condition="python:delta_depth == 0"
                       tal:replace="structure string:&lt;/dd>" />
            <dt>
              <img tal:condition="python:getattr(box['box'],'display_icons',0)"
                   tal:replace="structure
                                  python:
                                    here.getImgTag(here.portal_types[item['portal_type']].getIcon(),
                                                   base_url=base_url)" />
              <a href="."
                 tal:attributes="href string:${base_url}${item/rpath}/;
                                 class python:test(context_url.endswith(
                                       item['rpath']),'selected', default);">
                <tal:block tal:replace="structure python:item['title_or_id']">
                  id
                </tal:block>
              </a>
              <tal:block tal:condition="display_managers">
                <tal:block tal:define="managers python:item['managers']"
                           tal:condition="managers">
                  - [
                  <tal:block tal:repeat="manager managers">
                    <tal:block tal:condition="python:
                         here.portal_directories.members.getEntry(manager, default=None)">
                      <a style="font-style:italic" href=""
                         tal:content="
                           python:
                             here.portal_directories.members.getEntry(manager).get(
                                                 'fullname',manager)"
                         tal:attributes="href
                           python:
                             here.portal_url.getPortalPath() +
                               '/directory_getentry?dirname=' +
                               here.portal_directories.members.getId() +
                               '&amp;id='+manager">
                      </a>
                      <tal:block tal:condition="not:repeat/manager/end">,</tal:block>
                    </tal:block>
                  </tal:block> ]
                </tal:block>
              </tal:block>
            </dt>
            <tal:block tal:replace="structure string:&lt;dd>" />
            <tal:block tal:condition="python:getattr(box['box'],
                                                     'display_description',
                                                     0)">
              <tal:block tal:replace="item/description" />
            </tal:block>
            <tal:block tal:define="global last_depth python:item['depth']" />
          </tal:block>
        </tal:block>
        <tal:block tal:repeat="i python:range(0,last_depth)">
          <tal:block tal:replace="structure string:&lt;/dd>&lt;/dl>"/>
        </tal:block>
      </tal:block>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_sitemap_adv"
  tal:define="items python:box['box'].getTree(here);">
<metal:block use-macro="python:path(box['settings']['box_skin'])">
  <metal:block fill-slot="box_title"
     tal:content="box/box/title" i18n:translate="">
       box text title
  </metal:block>
  <metal:block fill-slot="box_body"
    tal:define="mtool nocall:here/portal_directories/members;
                host here/portal_url/aq_parent/absolute_url;">
    <tal:block repeat="item items">
      <h2 tal:condition="repeat/item/start"
        i18n:translate="">label_collaborative_folder</h2>
        <metal:block define-macro="display_folder"
          tal:condition="python:
           item['portal_type'] in ('Workspace', 'Section') and not context_url.endswith(item['rpath'])">
        <img tal:condition="python:getattr(box['box'],'display_icons',0)"
          tal:replace="structure python:
            here.getImgTag(here.portal_types[item['portal_type']].getIcon(),
                                                   base_url=base_url)" />
        <a tal:attributes="href string:${base_url}${item/rpath}/"
          tal:omit-tag="not:item/visible"><b
        tal:content="string:${item/title_or_id}" /></a>
        <div style="padding-left:1.5em">
          <tal:block repeat="manager item/managers">
            <tal:block define="emanager python:mtool.getEntry(manager, default=None);"
              condition="emanager">
            <a tal:condition="emanager/email|nothing"
              tal:attributes="href
                string:mailto:${emanager/email}?subject=[${item/title_or_id}];
                title emanager/email;">
              <img
                tal:replace="structure python:here.getImgTag('mail_icon.jpg',
                base_url=base_url)" />
              <span tal:replace="emanager/fullname|manager" />
            </a>
             <span
              tal:condition="not:emanager/email"
              tal:content="emanager/fullname|manager" /><tal:block
              condition="not:repeat/manager/end">,</tal:block>
            <br tal:condition="repeat/manager/end" />
            </tal:block>
          </tal:block>
          <tal:block condition="item/description">
            <tal:block replace="item/description" /><br />
          </tal:block>
          <small class="url"
           tal:define="url python: here.truncURL(base_url + item['rpath'])"
           tal:content="url">URL</small>
        </div><br />
        </metal:block>
    </tal:block>
    <tal:block>
      <h2 i18n:translate="">label_folder_search</h2>
      <div style="float: right;">
        <tal:block
          repeat="char string:ABCDEFGHIJKLMNOPQRSTUVWXYZ">
          <strong style="cursor: pointer;" class="even"
           tal:attributes="onclick
           string:document.getElementById('queryfolder').value = '\^${char}';;
           searchfolderform.submit()"
           tal:content="char"/>
        </tal:block>
      </div>
      <div>
      <form method="post" name="searchfolderform"
        tal:attributes="action here_url">
        <span i18n:translate="box_search">Search:</span>
        <input id="queryfolder" type="text" name="query_folder" size="20"
         value="" tal:attributes="value request/query_folder|nothing" />
        <input class="context searchButton" type="submit" value="button_ok"
          i18n:attributes="value" />
      </form></div><br />
      <tal:block tal:define="query_folder request/query_folder|nothing"
         condition="query_folder">
        <tal:block define="items python:box['box'].searchFolder(here, query_folder)">
          <tal:block condition="python: not len(items)">
            <span i18n:translate="legend_folder_no_search_result">nop</span>
          </tal:block>
          <tal:block repeat="item items">
            <metal:block use-macro="here/boxes_nuxeo/macros/display_folder" />
          </tal:block>
        </tal:block>
      </tal:block>

    </tal:block>
  </metal:block>
</metal:block>
</metal:block>



<!-- ============================================================ -->
<metal:block define-macro="treebox_nav"
  tal:define="items python:box['box'].getNavTree(here, request.form);">
<tal:block condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title">
      <metal:block define-slot="box_title">
        <tal:block i18n:translate=""
          content="box/box/title">box text title</tal:block>
      </metal:block>
    </metal:block>
    <metal:block fill-slot="box_body">
  <div tal:repeat="node items">
    <metal:block use-macro="here/navigation_lib_render_lines_text/macros/render_lines_text" />
    <a tal:define="title_or_id python:node['object']['Title'] or node['object']['getId']"
      tal:attributes="
      class python:test(node['is_current'], 'selected', nothing);
      href string:${base_url}${node/uid};"
      tal:content="title_or_id" />
  </div>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_menu"
  tal:define="items python:box['box'].getTree(here.portal_url.getPortalObject())">
<ul id="menuSectionsAndWorkspaceRoot" class="menuTabs" tal:condition="items"><tal:block repeat="item items">
  <li tal:condition="python:item['portal_type']=='Section' or item['depth']==0"
    tal:define="class_name python:test(item['portal_type']=='Section', 'section', 'workspace')"
    tal:attributes="class python:test(context_url.endswith(item['rpath']), class_name+' selected', class_name)"><a
    tal:attributes="href string:${base_url}${item/rpath}/;title item/title"
    tal:content="structure item/short_title">Folder title</a></li></tal:block>
</ul>
<br style="clear: both;" />
</metal:block>


<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_default"
  tal:define="items python:box['box'].getActions(here, actions)">
<tal:block condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title">
      <metal:block define-slot="box_title">
        <tal:block i18n:translate=""
          content="box/box/title">box text title</tal:block>
      </metal:block>
    </metal:block>
    <metal:block fill-slot="box_body">
      <tal:block repeat="category items">
      <tal:block condition="python:len(category)" i18n:domain="Default">
        <br tal:condition="not:repeat/category/start" />
        <ul>
          <li tal:repeat="action category"><a i18n:translate=""
            tal:attributes="href action/url;"
            tal:content="action/name">Action</a></li>
        </ul>
      </tal:block>
      </tal:block>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>

<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_user">
  <metal:block use-macro="here/boxes_nuxeo/macros/actionbox_default">
    <metal:block fill-slot="box_title">
      <span tal:condition="isAnon"
            i18n:translate="label_guest">
        Guest
      </span>
      <a href="." accesskey="H"
         tal:define="mdir here/portal_directories/members;
                     entry python:not isAnon and mdir.getEntry(uname, {});
                     home_folder mtool/getHomeFolder"
         tal:condition="not:isAnon"
         tal:content="python:entry.get('fullname', uname)"
         tal:attributes="href python:home_folder is not None
                                 and '%s/' % home_folder.absolute_url()"
         tal:omit-tag="python:home_folder is None">
        box text title
      </a>
    </metal:block>
  </metal:block>
</metal:block>

<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_menu"
  tal:define="items python:box['box'].getActions(here, actions);
              row_len python:3">
  <div class="contentTabs" tal:condition="items">
    <tal:block repeat="category items">
      <tal:block condition="python:len(category)">
        <!-- br tal:condition="not:repeat/category/start" -->
        <tal:block repeat="action category">
          <tal:block
            define="selected python:request['URL'].startswith(action['url'])
                                    or (action['id']=='view'
                                        and
                                       (request['URL'] == here_url or
                                        request['URL'].endswith('/view')))">
          <span class="opentab" tal:attributes="class python:test(selected, 'opentabSelected', default)">&#160;</span><a i18n:translate=""
             tal:attributes="href action/url;
                             class python:test(selected, 'selected', default)"
             tal:content="action/name">Action</a><span class="closetab" tal:attributes="class python:test(selected, 'closetabSelected', default)">&#160;</span>
            <br tal:condition="python:repeat['action'].number()%row_len==0
                                      and not (repeat['action'].end and repeat['category'].end)" />
          </tal:block>
        </tal:block>
      </tal:block>
    </tal:block>
  </div>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="actionbox_header"
  tal:define="items python:box['box'].getActions(here, actions);
              row_len python:3">
  <div class="headerActions" tal:condition="items">
    <ul tal:repeat="category items">
      <li tal:condition="python:len(category)"
          tal:repeat="action category">
         <a i18n:translate=""
           tal:attributes="href action/url"
           tal:content="action/name">Action</a>
        <tal:block condition="not:repeat/action/end">-</tal:block>
      </li>
    </ul>
  </div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="imagebox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title">box image title</metal:block>
    <metal:block fill-slot="box_body" tal:condition="box/box/image_name">
      <a href="" tal:omit-tag="not:box/box/image_link"
        tal:attributes="href box/box/image_link">
        <tal:block replace="structure box/box/image_id" />
      </a>
    </metal:block>
  </metal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="flashbox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title">Flash Box Title</metal:block>
    <metal:block fill-slot="box_body" tal:condition="box/box/flash_filename">
      <object type="application/x-shockwave-flash"
              tal:define="flashobject_url box/box/flash_id/absolute_url"
              tal:attributes="data flashobject_url;
                              width box/box/flash_id/flash_width;
                              height box/box/flash_id/flash_height">
        <param name="movie" value="" tal:attributes="value flashobject_url" />
        <span><a href="http://www.macromedia.com/">Macromedia Flash Plugin</a> required</span>
      </object>
    </metal:block>
  </metal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="internallinksbox_default"
  tal:define="items python:box['box'].getContents();
              items python:[elem[0] for elem in items]
              " tal:condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>
    <metal:block fill-slot="box_body">
       <tal:block define="
          no_form python:1;
          filter python:0;
          items_per_page box/box/nb_items|python:10;
          nav_action string:folder_view;">
          <metal:block use-macro="here/content_lib_display_contents/macros/display_contents" />
       </tal:block>
      <metal:block use-macro="here/xml_exports/macros/rss_atom_exports"/>
    </metal:block>
  </metal:block>
</metal:block>



<!-- =========================================================== -->
<metal:block define-macro="docrenderbox_default"
          tal:define="doc_rendering python:box['box'].getContents(here)"
    tal:condition="doc_rendering">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title
    </metal:block>

    <metal:block fill-slot="box_body" tal:content="structure doc_rendering" />
  </metal:block>
 </metal:block>

<!-- ============================================================ -->
<!--
This macro is deprecated but kept here for backward compatibility.
This box is now a text box.
-->
<metal:block define-macro="basebox_welcome">
  <p>
    This box is deprecated.
  </p>
  <p>
    Remove this "welcome" box and run the CPS installer again,
    this old box will be replaced by a new updated one.
  </p>
</metal:block>


<!-- ============================================================ -->
<!--
This macro is deprecated but kept here for backward compatibility.
This box is now a text box.
-->
<metal:block define-macro="basebox_footer">
  <p>
    This box is deprecated.
  </p>
  <p>
    Remove this "footer" box and run the CPS installer again,
    this old box will be replaced by a new updated one.
  </p>
</metal:block>
