<!-- macro library for contents -->
<!-- $Id$ -->

<!-- ============================================================ -->
<pre>a master macro used for content stuff:</pre>
<metal:block define-macro="master"
             tal:define="proxy here/this;
                         doc doc|here/getContent|nocall:here">
  <metal:block use-macro="here/main_template/macros/master">

    <metal:block fill-slot="base">
      <tal:block define="rpath python:utool.getRelativeContentURL(here)"
                 replace="structure string:<!--
                            cps test / debug information:
                            cps:path:${here/absolute_url}
                            cps:rpath:${rpath}
                            cps:proxy_id:${proxy/id}
                            cps:id:${doc/id}
                            -->">
        <!-- XXX debug stuff -->
      </tal:block>

      <metal:block define-slot="base">
        <base href="" tal:attributes="href python: here.absolute_url() + '/'">
      </metal:block>
    </metal:block>

    <metal:block fill-slot="header">
      <metal:block define-slot="header">
        <h1 tal:content="here/title_or_id">
          Page Title
        </h1>

        <div metal:use-macro="here/content_byline/macros/byline">By Me</div>

        <div class="description" tal:content="doc/Description">
          Document Description goes here.
        </div>
      </metal:block>
    </metal:block>

    <metal:block fill-slot="main">
      <metal:block define-slot="main" />
    </metal:block>

    <metal:block fill-slot="sub">
      <metal:block define-slot="sub">
        <div class="box" tal:condition="doc/viewThreadsAtBottom|nothing"
             tal:content="structure doc/viewThreadsAtBottom">
          Discussion goes here
        </div>
      </metal:block>
    </metal:block>

  </metal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a std formated main:</pre>
<metal:block define-macro="std_main">
  <div class="Desktop">
    <h1><metal:block define-slot="title">title</metal:block></h1>
    <em><metal:block define-slot="help">help</metal:block></em><br><br>
    <div metal:define-slot="main">
       main bla
    </div>
  </div>
</metal:block>


<!-- ============================================================ -->
<pre>form used for state transition:</pre>
<metal:block define-macro="transition_form">
<form method="post" action="content_status_modify"
  tal:attributes="action string:${proxy/absolute_url}/content_status_modify">
  <div metal:define-slot="fields">
    <!-- more fields -->
  </div>
  <strong><em i18n:translate="transition_comments">Comments</em></strong><br>
  <textarea name="comment" cols="60" rows="5" wrap="soft" style="width: 100%"
            tal:content="nothing">
  </textarea>
  <div metal:define-slot="button">
    <!-- these are examples -->
    <input type="hidden" name="workflow_action" value="transition">
    <input type="submit" value="button_publish" i18n:attributes="value">
  </div>
</form>
</metal:block>


<!-- ============================================================ -->
<pre>list contents in 'items' in the specified number of columns with the given
format:</pre>
<metal:block define-macro="display_contents">
<tal:block define="nav_action nav_action|string:folder_contents;
                   columns columns|python:2;
                   items_per_page items_per_page|python:10;
                   mq nocall:modules/ZTUtils/make_query;
                   form request/form;
                   batches python:here.getBatchList(items, columns, items_per_page);
                   format format|string:detail"><!-- detail, compact, icon -->
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td align="left" valign="top"
          tal:attributes="width python:str(100 / columns)+'%'"
          tal:repeat="batch_items batches">
          <metal:block
                use-macro="here/content_lib/macros/display_contents_column" />
      </td>
    </tr>
  </table>
  <br>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td width="50%" align="left" nowrap>
        <span tal:define="p python:batches[0]" tal:condition="p/previous">
          <a href=""
             tal:define="previous p/previous/first"
             tal:attributes="href python:nav_action + '?'
                                         + mq(form, b_start=previous)"
             i18n:translate="batch_previous_items">Previous Items</a>
         </span>
      </td>
      <td width="50%" align="right" nowrap>
        <span tal:define="n python:batches[-1]" tal:condition="n/next">
          <a href=""
             tal:define="next n/next/first"
             tal:attributes="href python:nav_action + '?'
                                         + mq(form, b_start=next)"
             i18n:translate="batch_next_items">Next Items</a>
        </span>
      </td>
    </tr>
  </table>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<pre>final display of items in a column using the given format:</pre>
<metal:block define-macro="display_contents_column">
  <tal:block define="no_form no_form|nothing;
                     format format|string:icon">
  <table width="100%" border="0" cellspacing="0" cellpadding="5">
    <tr valign="top" tal:repeat="item batch_items">
      <td tal:condition="not:no_form" align="left" valign="top" width="5">
        <input type="checkbox" name="ids:list" value="" id=""
               tal:attributes="value item/getId;
                               id python:'cb_'+item.getId()">
      </td>
      <td align="left" valign="top"
          tal:define="info python:here.getContentInfo(item, level=1)">
        <metal:block
          use-macro="python:path('here/content_lib/macros/info_%s' % format)" />
      </td>
    </tr>
  </table>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require tal:define="info getContentInfo(item)   -->


<!-- ============================================================ -->
<pre>status of a content:</pre>
<metal:block define-macro="status">
  <tal:block condition="not:status_short_fmt|nothing">
    <tal:block i18n:translate="">
      label_status
      <span tal:content="info/review_state"
            i18n:name="review_state">Work</span>
    </tal:block>
    <tal:block i18n:translate="">
      label_revision
      <span tal:content="info/rev"
            i18n:name="status_revision">1</span>
    </tal:block>
    <tal:block i18n:translate="">
      label_language
      <span tal:content="info/lang"
            i18n:name="status_language">en</span>
    </tal:block>
    <tal:block condition="status_time|nothing" i18n:translate="">
      label_since
      <span tal:content="info/stime"
            i18n:name="status_time">May 6, 2003 5:28 pm</span>
    </tal:block>
  </tal:block>
  <tal:block condition="status_short_fmt|nothing" i18n:translate="">
    <tal:block condition="status_time|nothing">
      <span tal:content="info/stime"
            i18n:name="status_time">May 6, 2003 5:28 pm</span>:
    </tal:block>
    v<span tal:replace="info/rev" i18n:name="status_revision">1</span>-<span
    tal:replace="info/lang" i18n:name="status_language">en</span>
    <span tal:replace="info/review_state"
          i18n:name="review_state">published</span>
  </tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo level 1                  -->


<!-- ============================================================ -->
<pre>all doc information in a table:</pre>
<metal:block define-macro="info_detail">
<table cellspacing="0" cellpadding="0" width="100%"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EFEFEF' or nothing">
  <tr><td width="20">
   <img src="" border="0"
     tal:attributes="src string:/${info/icon};
                     title info/type;"/>
  </td><td>
   <a href="" tal:attributes="href string:/${info/rpath}/view">
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
  </td></tr>
  <tr><td colspan="2" nowrap>
  <a href="" tal:attributes="href string:/${info/rpath}/view">
  <small>
    <span tal:replace="string:id:${info/id}">[id]</span>,
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span tal:replace="info/size|nothing">10 kB</span>
  </small>
  </a>
  </td></tr>
  <tr tal:condition="info/description"><td colspan="2">
    <small><em><span tal:replace="info/description">Description</span></em></small>
  </td></tr>
</table>
</metal:block>

<!-- ============================================================ -->
<pre>iconic doc information in a table:</pre>
<metal:block define-macro="info_icon">
<table border="0" cellspacing="0" cellpadding="0" width="100%"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EEEEEE' or nothing">
  <tr><td align="center">
   <a href="" tal:attributes="href string:${info/id}/view;
                              title info/description;">
    <img src="" border="0" width="30" length="40"
     tal:attributes="src string:/${info/icon};"/></a>
  </td></tr>
  <tr><td align="center">
   <a href="" tal:attributes="href string:${info/id}/view;"
      title="info/description">
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
  </td></tr>
</table>
</metal:block>

<!-- ============================================================ -->
<pre>short doc information in a table:</pre>
<metal:block define-macro="info_compact">
<table cellspacing="0" cellpadding="0" width="100%"
  tal:attributes="bgcolor python:info['review_state'] == 'pending' and '#EEEEEE' or nothing">
  <tr><td width="20">
   <img src="" border="0"
     tal:attributes="src string:/${info/icon};
                     title info/type;"/>
  </td><td>
   <a href="" tal:attributes="href string:/${info/rpath}/view;
                              title info/description">
     <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
   <small>
    id:<span tal:replace="info/id">[id]</span>,
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
   </small>
  </td></tr>
</table>
</metal:block>



<!-- ============================================================ -->
<!-- below macros require getContentInfo 2                        -->


<!-- ============================================================ -->
<pre>display authorized proxies states for a document</pre>
<metal:block define-macro="states">
<strong i18n:translate="">label_publication_states</strong><br>
<span tal:repeat="item info/states">
  <span tal:condition="python:item['review_state'] != 'work'">
    <tal:block define="info item;
                       status_time not:nothing;
                       status_short_fmt not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span i18n:translate="">label_in_section
      <a href="." tal:attributes="href string:${base_url}${item/rpath}/"
         tal:content="item/title" i18n:name="section_id">Section</a>
    </span><br>
  </span>
</span>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 3                        -->


<!-- ============================================================ -->
<pre>display authorized history of a document</pre>
<metal:block define-macro="history">
  <strong i18n:translate="label_reviewing_history">Reviewing history:</strong><br>
  <span tal:repeat="item info/history" i18n:translate="">
    <span tal:content="item/stime"
          i18n:name="history_time">May 6, 2003 5:28 pm</span>:
    <span tal:content="item/action" i18n:name="history_action">publish</span>
    <tal:block condition="item/has_dest|nothing">
    into <span i18n:name="history_dest"><a href="." tal:content="item/dest_title" tal:attributes="href string:${base_url}${item/dest_container}/">Foo Section</a></span>
    </tal:block>
    by <span tal:replace="item/actor" i18n:name="history_actor">bob</span>:
    <em tal:content="item/comments|nothing" i18n:name="history_comments">
      Comments
    </em><br>
  </span>
</metal:block>
