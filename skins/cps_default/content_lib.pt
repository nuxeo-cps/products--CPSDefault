<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns="http://www.w3.org/1999/xhtml">
<body>

<!-- macro library for contents -->
<!-- $Id$ -->

<!-- ============================================================ -->
<pre>a master macro used for content stuff:</pre>
<metal:block define-macro="master"
  tal:define="proxy here/this;
  doc nocall:doc|python:here.getContent()">
<metal:block use-macro="here/main_template/macros/master">
<metal:block fill-slot="base">
<tal:block replace="structure string:&lt;!--
  cps test / debug information:
  cps:path:${here_url}
  cps:rpath:${context_url}
  cps:proxy_id:${proxy/id}
  cps:id:${doc/id}
-->"></tal:block>
<metal:block define-slot="base">
  <base href="" tal:attributes="href python: here_url + '/'" />
</metal:block>
</metal:block>

<metal:block fill-slot="head_slot"><metal:block
  define-slot="head_slot" /></metal:block>
<metal:block fill-slot="css_slot"><metal:block define-slot="css_slot"
  /></metal:block>
<metal:block fill-slot="javascript_head_slot"><metal:block
  define-slot="javascript_head_slot" /></metal:block>

<metal:block fill-slot="header">
<metal:block define-slot="header">
  <h1 tal:content="here/title_or_id">Page Title</h1>
  <div class="description" tal:content="doc/Description"
    tal:condition="doc/Description">
    Document Description goes here.
   </div>
</metal:block>
</metal:block>

<metal:block fill-slot="main">
<metal:block define-slot="main" />
</metal:block>

<metal:block fill-slot="sub">
<metal:block define-slot="sub">
  <div tal:condition="not:creation|nothing"
    style="clear:both; text-align:right; border-top: solid 1px; margin-top: 2em;">
    <small>
      <span metal:use-macro="here/content_lib/macros/byline">By Me</span>
    </small>
  </div>
</metal:block>
</metal:block>

</metal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a std formated main:</pre>
<metal:block define-macro="std_main">
  <h1><metal:block define-slot="title">title</metal:block></h1>
  <em><metal:block define-slot="help">help</metal:block></em><br /><br />
  <metal:block define-slot="main">main bla</metal:block>
</metal:block>


<!-- ============================================================ -->
<pre>a footer for a document or a folder:</pre>
<metal:block metal:define-macro="byline"
  tal:define="dname python:here.portal_directories.members.getEntry(doc.Creator(), default=None);
  cname dname/fullname|doc/Creator;
  info python:(here_url != utool.getPortalObject().absolute_url())
  and here.getContentInfo(doc=doc, level=2) or None;
  email dname/email|nothing;">
  <span i18n:translate="">
    Created by
    <a href="." title="Here" tal:omit-tag="not:email"
      tal:attributes="href string:mailto:${email}?subject=[${doc/title}]; title email"
      tal:content="cname" i18n:name="item_creator">Creator</a>.
    Last modified
    <tal:block content="python:here.getDateStr(doc.modification_date, 'medium')"
      i18n:name="item_modification" />.
  </span>
  <tal:block condition="info">
    <span i18n:translate="label_status">Label Status</span>
    <span tal:content="info/review_state" tal:attributes="class
      info/review_state" i18n:translate="">Work</span>
    <tal:block i18n:translate="">label_revision
      <span tal:content="info/rev" i18n:name="status_revision">1</span>
    </tal:block>
    <tal:block i18n:translate="">label_language
      <span i18n:name="status_language">
      <tal:block i18n:translate=""
        content="string:label_language_${info/lang}">en</tal:block>
       </span>
    </tal:block>
  </tal:block>
</metal:block>
          

<!-- ============================================================ -->
<pre>form used for state transition:</pre>
<metal:block define-macro="transition_form">
<form class="workflow" method="post" action="content_status_modify"
  tal:attributes="action string:${proxy/absolute_url}/content_status_modify">
  <p metal:define-slot="fields">
    <!-- more fields -->
  </p>
    <dl>
      <dt><label for="comment" i18n:translate="transition_comments">Comments</label></dt>
      <dd>
        <textarea name="comment" id="comment" cols="60" rows="5"
                  tal:content="nothing">
        </textarea>
      </dd>
    </dl>
  <p metal:define-slot="button">
    <!-- these are examples -->
    <input type="hidden" name="workflow_action" value="transition" />
    <input type="submit" value="button_publish" i18n:attributes="value" />
  </p>
</form>
</metal:block>


<!-- ============================================================ -->
<pre>list contents in 'items' in the specified number of columns with the given
format:</pre>
<metal:block define-macro="display_contents">
<tal:block
  define="tmp_format format|nothing;
          tmp_sort_by sort_by|nothing;
          tmp_direction direction|nothing;
          tmp_columns columns|nothing;
          tmp_items_per_page items_per_page|nothing;
          tmp_nav_action nav_action|nothing;
          tmp_filter filter|nothing;
          tmp_detail_tab_columns detail_tab_columns|nothing;
          params python:here.getDisplayParams(format=tmp_format,
                          sort_by=tmp_sort_by,
                          direction=tmp_direction,
                          columns=tmp_columns,
                          items_per_page=tmp_items_per_page,
                          nav_action=tmp_nav_action,
                          nb_items=len(items),
                          filter=tmp_filter,
                          detail_tab_columns=tmp_detail_tab_columns);
          format params/format;
          sort_by params/sort_by;
          direction params/direction;
          columns params/columns;
          items_per_page params/items_per_page;
          nav_action params/nav_action;
          filter params/filter;
          detail_tab_columns params/detail_tab_columns;
          mq nocall:modules/ZTUtils/make_query;
          form request/form;
          zoom zoom|python:0;
          batches_all python:here.getBatchList(items, columns, items_per_page,
                                               zoom);
          batches python:batches_all[0];
          batch_info python:batches_all[1];
          zoomed python:batches_all[2];
     ">
 <tal:block tal:condition="python: batch_info and batch_info['nb_pages'] > 1">
    <div class="batchLayout">
        <span i18n:translate="">
          Objects: <tal:block replace="batch_info/start"
          i18n:name="batch_start" /> - <tal:block replace="batch_info/limit"
          i18n:name="batch_limit" /> of <tal:block replace="batch_info/length"
          i18n:name="batch_length" />
         </span>
    </div>
  <br />
 </tal:block>
  <table width="100%" border="0" cellspacing="0" cellpadding="0"
    summary="zoomed layout"
    tal:condition="zoomed">
    <tr tal:repeat="item zoomed">
      <td align="left" valign="top">
       <tal:block define="no_form not:nothing;
         info python:here.getContentInfo(item, level=1, cpsmcat=cpsmcat);">
         <metal:block use-macro="here/content_lib/macros/info_summary" />
         <br /><br />
       </tal:block>
      </td>
    </tr>
  </table>
  <table width="100%" border="0" cellspacing="0" cellpadding="0"
    summary="content layout column"
    tal:condition="batches">
    <tr tal:define="col_width python:str(100 / columns)+'%'">
      <td align="left" valign="top"
          tal:attributes="width col_width"
          tal:repeat="batch_items batches">
        <tal:block condition="batch_items">
          <metal:block
            use-macro="here/content_lib/macros/display_contents_column" />
        </tal:block>
      </td>
    </tr>
  </table>
  <tal:block condition="python:batch_info and batch_info['nb_pages'] > 1">
    <br />
      <div class="pageNavigationLayout">
          <span i18n:translate="label_page">Pages</span>:
          <a tal:define="previous batch_info/previous"
             tal:condition="python:previous is not None"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                            mq(request.form, b_start=previous))"
             i18n:translate="batch_previous">Previous</a>
          <tal:block repeat="page batch_info/pages">
            <a tal:condition="python:page != batch_info['start'] - 1"
              tal:attributes="href python:'%s?%s'%(request['URL'],
                mq(request.form, b_start=page))"
              tal:content="repeat/page/number">1</a>
            <span tal:condition="python:page == batch_info['start'] - 1"
              tal:content="string:[${repeat/page/number}]" />
          </tal:block>
          <a tal:define="next batch_info/next"
             tal:condition="python:next is not None"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                                mq(request.form, b_start=next))"
             i18n:translate="batch_next">Next</a>
      </div>
  </tal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<pre>final display of items in a column using the given format:</pre>
<metal:block define-macro="display_contents_column">
  <tal:block define="no_form no_form|nothing;
                     site_wide site_wide|nothing;
                     format python:format or 'detail';
                     choosen_ids python:request.SESSION.get('choosen_ids', []);
                     dummy python:request.SESSION.update({'choosen_ids': []});
                     no_table python:format == 'detail_tab';">
  <table tal:condition="not:no_table" width="100%" border="0" cellspacing="0"
    cellpadding="5" summary="content column layout">
    <tr valign="top" tal:repeat="item batch_items">
      <td tal:condition="not:no_form" align="left" valign="top" width="5">
        <input type="checkbox" name="ids:list" value="" id="" class="noborder"
               tal:define="id item/getId"
               tal:attributes="value
                 python:site_wide and item.getContextUrl(utool=utool) or id;
                 id python:'cb_' + id;
                 checked python:id in choosen_ids;
           " />
      </td>
      <td align="left" valign="top"
          tal:define="info python:here.getContentInfo(item, level=1, cpsmcat=cpsmcat)">
        <metal:block use-macro="python:path('here/content_lib/macros/info_%s'%format)" />
      </td>
    </tr>
  </table>
  <tal:block condition="no_table">
    <tal:block repeat="item batch_items">
    <tal:block define="info python:here.getContentInfo(item, level=1, cpsmcat=cpsmcat);
                       start repeat/item/start|nothing;
                       end repeat/item/end|nothing">
      <metal:block use-macro="here/content_lib/macros/info_detail_tab" />
    </tal:block>
    </tal:block>
  <br />
  </tal:block>
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<pre>Display of a form to change display params</pre>
<metal:block define-macro="display_params_form">
  <span i18n:translate="label_sort_by">sort by</span>
  <select name="display_order">
    <option i18n:translate="label_none" value="None"
            tal:attributes="selected not:sort_by">
            No sort
    </option>

    <option i18n:translate="label_title_asc" value="title_asc"
            tal:attributes="selected
                              python:sort_by == 'title' and direction == 'asc'">
            Title ascending
    </option>
    <option i18n:translate="label_title_desc" value="title_desc"
            tal:attributes="selected
                             python:sort_by == 'title' and direction == 'desc'">
            Title descending
    </option>

    <option i18n:translate="label_date_asc" value="date_asc"
            tal:attributes="selected
                              python:sort_by == 'date' and direction == 'asc' ">
            Date ascending
    </option>
    <option i18n:translate="label_date_desc" value="date_desc"
            tal:attributes="selected
                             python:sort_by == 'date' and direction == 'desc' ">
            Date descending
    </option>

    <option i18n:translate="label_status_asc" value="status_asc"
            tal:attributes="selected
                             python:sort_by == 'status' and direction == 'asc'">
            Status ascending
    </option>
    <option i18n:translate="label_status_desc" value="status_desc"
            tal:attributes="selected
                             python:sort_by == 'status' and direction =='desc'">
            Status descending
    </option>

    <option i18n:translate="label_author_asc" value="author_asc"
            tal:attributes="selected
                             python:sort_by == 'author' and direction == 'asc'">
            Author ascending
    </option>
    <option i18n:translate="label_author_desc" value="author_desc"
            tal:attributes="selected
                             python:sort_by == 'author' and direction =='desc'">
            Author descending
    </option>
  </select>

  <span i18n:translate="label_display">Display with</span>
  <select name="display_style">
    <option i18n:translate="label_default" value="None"
            tal:attributes="selected not:format">
            Default
    </option>
    <option i18n:translate="label_icons" value="icon"
            tal:attributes="selected python:format == 'icon'">
            Icon
    </option>
    <option i18n:translate="label_compact" value="compact"
            tal:attributes="selected python:format == 'compact'">
            Compact
    </option>
    <option i18n:translate="label_detailed" value="detail"
            tal:attributes="selected python:format == 'detail'">
            Detail
    </option>
    <option i18n:translate="label_detailed_tab" value="detail_tab"
            tal:attributes="selected python:format == 'detail_tab'">
            Detail Tab
    </option>
  </select>
</metal:block>

<!-- ============================================================ -->
<!-- below macros require tal:define="info getContentInfo(item)   -->


<!-- ============================================================ -->
<pre>status of a content:</pre>
<metal:block define-macro="status">
  <tal:block condition="not:status_short_fmt|nothing">
    <span i18n:translate="label_status">Label Status</span>
    <span tal:content="info/review_state" tal:attributes="class
      info/review_state" i18n:translate="">Work</span>
    <tal:block i18n:translate="">label_revision
      <span tal:content="info/rev" i18n:name="status_revision">1</span>
    </tal:block>
    <tal:block i18n:translate="">label_language
      <span i18n:name="status_language">
      <tal:block i18n:translate=""
        content="string:label_language_${info/lang}">en</tal:block>
       </span>
    </tal:block>
    <tal:block condition="status_time|nothing" i18n:translate="">label_since
      <span tal:content="info/time_str" i18n:name="status_time">May28 pm</span>
    </tal:block>
  </tal:block>
  <tal:block condition="status_short_fmt|nothing" >
    <tal:block condition="status_time|nothing">
      <span tal:content="info/time_str">May 6,...</span>:
    </tal:block>
    <span i18n:translate="">
      v<span tal:replace="info/rev" i18n:name="status_revision">1</span>-       <span i18n:name="status_language">
      <tal:block i18n:translate=""
        content="string:label_language_${info/lang}">en</tal:block>
      </span>
    </span>
    <span tal:content="info/review_state" tal:attributes="class
      info/review_state" i18n:translate="">publish</span>
    <em tal:attributes="class info/review_state"
       tal:condition="info/review_state_date|nothing"
       tal:content="info/review_state_date" />
  </tal:block>
</metal:block>

<!-- ============================================================ -->
<!-- below macros require getContentInfo level 1                  -->


<!-- ============================================================ -->
<pre>all doc information:</pre>
<metal:block define-macro="info_detail">
<div
  tal:attributes="class python:test(info['hidden'], 'hiddenItem', nothing)"
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
  <div tal:condition="info/preview|nothing" style="float: right">
    <img tal:condition="info/preview|nothing"
      tal:replace="structure python:here.getImgTag(info['preview'],
        base_url=base_url, width=64, height=64, keep_ratio=1)" />
  </div>
  <a tal:attributes="href info/relation" tal:omit-tag="not:info/relation">
  <img tal:replace="structure python:here.getImgTag(info['icon'],
    base_url=base_url, title='%s, id:%s' % (info['type_l10n'], info['id']))" />
  </a>
   <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action};">
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
  <br />
  <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action}">
  <small>
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <tal:block condition="info/size|nothing">, <span tal:replace="info/size">
      10 kB</span>
    </tal:block>
  </small>
  </a>
  <tal:block tal:condition="info/start_str|info/end_str|nothing">
    <br /><small>
      <span i18n:translate="label_from" tal:omit-tag="">From</span>
      <span tal:content="info/start_str|nothing" tal:omit-tag="" />
      <span i18n:translate="label_to" tal:omit-tag="">To</span>
      <span tal:content="info/end_str|nothing" tal:omit-tag="" />
    </small>
  </tal:block>
  <tal:block condition="info/description">
    <br /><small tal:content="info/description">Description</small>
  </tal:block>
  <tal:block condition="site_wide|nothing">
   <br /><small class="url"
           tal:define="url python: here.truncURL(base_url + info['rpath'])"
           tal:content="url">URL</small>
  </tal:block>

</div>
</metal:block>

<!-- ============================================================ -->
<pre>iconic doc information:</pre>
<metal:block define-macro="info_icon">
<div style="text-align: center"
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
 <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action};
   title info/description;">
  <img tal:condition="not:info/preview|nothing"
       tal:replace="structure python:here.getImgTag(info['icon'],
       base_url=base_url, zoom=2, title=info['description'])" />
  <img tal:condition="info/preview|nothing"
       tal:replace="structure python:here.getImgTag(info['preview'],
       base_url=base_url, width='32', height='32', keep_ratio=1,
       title=info['description'])" />
   <br />
   <strong><span tal:replace="info/title_or_id">ID</span></strong></a>
</div>
</metal:block>

<!-- ============================================================ -->
<pre>compact doc information:</pre>
<metal:block define-macro="info_compact">
<div
  tal:attributes="class python:test(info['hidden'], 'hiddenItem', nothing)"
  tal:define="action
  python:test(info['type'] in ('Section','Workspace'), 'folder_contents', 'view')">
 <tal:block replace="structure python:path('here/'+ info['icon'])" />
 <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action};
   title info/description">
 <strong><span tal:replace="info/title_or_id">ID</span></strong></a><br />
 <small>
   <tal:block define="status_short_fmt not:nothing;
                      status_time not:nothing;">
     <metal:block use-macro="here/content_lib/macros/status" />
   </tal:block>
 </small>
</div>
</metal:block>


<!-- ============================================================ -->
<pre>all doc information + summary</pre>
<metal:block define-macro="info_summary">
<div tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view')">
  <h2>
    <img tal:replace="structure python:here.getImgTag(info['icon'],
                                       base_url=base_url, title=info['type'])" />
    <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action};">
    <strong tal:content="info/title_or_id">ID</strong></a>
  </h2>
  <div tal:condition="info/photo|nothing"
    style="float: left;margin: 1em;">
    <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action}"
      ><img tal:replace="structure python:here.getImgTag(info['photo'],
                         base_url=base_url, width=128, height=128, keep_ratio=1)" /></a>
  </div>
  <div>
  <small style="float: right;">
    <tal:block define="status_short_fmt not:nothing;
                       status_time not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <tal:block condition="info/size|nothing">, <span tal:replace="info/size">
      10 kB</span>
    </tal:block>
  </small>
  <tal:block condition="info/description">
    <br /><p tal:content="info/description">Description</p>
  </tal:block>
  <tal:block condition="info/summary|nothing">
    <p><q tal:content="info/summary">Summary</q></p>
  </tal:block>
  </div>
</div>
</metal:block>


<!-- ============================================================ -->
<pre>all doc information:</pre>
<metal:block define-macro="info_detail_tab"
             tal:define="title_in_tabs python:'title' in detail_tab_columns;
                         type_in_tabs python:'type' in detail_tab_columns;
                         size_in_tabs python:'size' in detail_tab_columns;
                         date_in_tabs python:'date' in detail_tab_columns;
                         author_in_tabs python:'author' in detail_tab_columns;
                         status_in_tabs python:'status' in detail_tab_columns;
                         version_in_tabs python:'version' in detail_tab_columns;
                         context_url context_url|here/getContextUrl;
                        ">
<tal:block condition="start">
  <tal:block replace='structure string:&lt;table class="contentListing" width="100%" summary="content layout">' />
    <tr>
      <td> </td>
      <th tal:condition="title_in_tabs" align="center">
        <strong tal:define="sort_title python:sort_by=='title'"
           tal:omit-tag="not:sort_title"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_title and direction=='asc','title_desc','title_asc'))"
           i18n:translate="label_info_tab_title"></a></strong></th>
      <th tal:condition="type_in_tabs" align="center">
        <strong tal:define="sort_type python:sort_by=='type'"
           tal:omit-tag="not:sort_type"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_type and direction=='asc','type_desc','type_asc'))"
           i18n:translate="label_info_tab_type"></a></strong></th>
      <th tal:condition="size_in_tabs" align="center">
        <strong tal:define="sort_size python:sort_by=='size'"
           tal:omit-tag="not:sort_size"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_size and direction=='asc','size_desc','size_asc'))"
           i18n:translate="label_info_tab_size"></a></strong></th>
      <th tal:condition="date_in_tabs" align="center">
        <strong tal:define="sort_date python:sort_by=='date'"
           tal:omit-tag="not:sort_date"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_date and direction=='asc','date_desc','date_asc'))"
           i18n:translate="label_info_tab_date"></a></strong></th>
      <th tal:condition="author_in_tabs" align="center">
        <strong tal:define="sort_author python:sort_by=='author'"
           tal:omit-tag="not:sort_author"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_author and direction=='asc','author_desc','author_asc'))"
           i18n:translate="label_info_tab_author"></a></strong></th>
      <th tal:condition="status_in_tabs" align="center">
        <strong tal:define="sort_status python:sort_by=='status'"
           tal:omit-tag="not:sort_status"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_status and direction=='asc','status_desc','status_asc'))"
           i18n:translate="label_info_tab_status"></a></strong></th>
      <th tal:condition="version_in_tabs" align="center">
        <strong tal:define="sort_version python:sort_by=='version'"
           tal:omit-tag="not:sort_version"><a href=""
           tal:attributes="href python:'%s/changeDisplayParams?display_order=%s' % (context_url, test(sort_version and direction=='asc','version_desc','version_asc'))"
           i18n:translate="label_info_tab_version"></a></strong></th>
    </tr>
</tal:block>

<tr tal:attributes="class python:test(repeat['item'].even(), 'even', 'odd')"
 tal:define="action python:test(info['type'] in ('Section','Workspace'),
                'folder_contents', 'view')">
  <td align="left" valign="center" width="5">
    <input type="checkbox" name="ids:list" value="" id="" class="noborder"
           tal:condition="not:no_form"
           tal:define="id item/getId"
           tal:attributes="value python:site_wide and item.getContextUrl(utool=utool) or id;
                           id python:'cb_' + id;
                           checked python:id in choosen_ids;
                          " />
  </td>
  <td tal:condition="title_in_tabs">
    <a href="" tal:attributes="href string:${base_url}${info/rpath}/${action};
                                 title info/description;">
    <strong tal:content="info/title_or_id">ID</strong></a></td>
  <td align="center" tal:condition="type_in_tabs">
    <img tal:replace="structure python:here.getImgTag(info['icon'], base_url=base_url, title=info['type'])" /></td>
  <td align="right" tal:condition="size_in_tabs">
    <span tal:condition="info/size|nothing" tal:content="info/size"> </span></td>
  <td align="center" tal:condition="date_in_tabs">
    <span tal:content="info/time_str">May 6,...</span></td>
  <td align="center" tal:condition="author_in_tabs">
    <span tal:content="info/creator"> </span></td>
  <td align="center" tal:condition="status_in_tabs"
      tal:content="info/review_state" tal:attributes="class info/review_state"
      i18n:translate="">published</td>
  <td align="center" tal:condition="version_in_tabs">
    v-<tal:block replace="info/rev" />
    <tal:block i18n:translate=""
      content="string:label_language_${info/lang}">en</tal:block>
  </td>
</tr>
<tal:block condition="end" tal:replace="structure string:&lt;/table>">
</tal:block>
</metal:block>

<!-- ============================================================ -->
<pre>simple doc information:</pre>
<metal:block define-macro="info_simple">
<div
  tal:define="action python:test(info['type'] in ('Section','Workspace'),
                                 'folder_contents', 'view');">
  <a tal:attributes="href info/relation" tal:omit-tag="not:info/relation">
  <img tal:replace="structure python:here.getImgTag(info['icon'],
       base_url=base_url, title=info['type'])" /></a>&nbsp;<a
   href="" tal:attributes="href string:${base_url}${info/rpath}/${action};
                           title info/description;">
<span tal:replace="info/title_or_id">ID</span></a>
<span tal:condition="display_description|nothing">
&nbsp;&nbsp;<br> 
  <span tal:replace="info/description"></span>
</span>
</div>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 2                        -->


<!-- ============================================================ -->
<pre>display authorized proxies states for a document</pre>
<metal:block define-macro="states">
<strong i18n:translate="">label_publication_states</strong><br />
<span tal:repeat="item info/states">
  <span tal:condition="python:item['review_state'] != 'work'">
    <tal:block define="info item;
                       status_time not:nothing;
                       status_short_fmt not:nothing;">
      <metal:block use-macro="here/content_lib/macros/status" />
    </tal:block>
    <span i18n:translate="">label_in_section
      <a href="." tal:attributes="href string:${base_url}${item/rpath}/"
         tal:content="item/title" i18n:name="section_id">Section</a>
    </span><br />
  </span>
</span>
</metal:block>


<!-- ============================================================ -->
<!-- below macros require getContentInfo 3                        -->


<!-- ============================================================ -->
<pre>display authorized history of a document</pre>
<metal:block define-macro="history">
  <strong i18n:translate="label_reviewing_history">Reviewing history:</strong><br />

  <span tal:repeat="item info/history">

    <span tal:content="item/time_str">May 6, 2003 5:28 pm</span>:

    <tal:block condition="python:item.get('language_revs')">
    <tal:block repeat="language_rev item/language_revs/items">
      <tal:block i18n:translate="">label_revision
        <span i18n:name="status_revision"
          tal:content="python:language_rev[1]">1</span>
      </tal:block>
      <tal:block i18n:translate="">label_language
        <span i18n:name="status_language">
        <tal:block i18n:translate=""
          content="python:'label_language_%s' % language_rev[0]">en</tal:block>
        </span>
      </tal:block>
    </tal:block>
    </tal:block>

    <span tal:content="item/action" i18n:translate="">published</span>

    <tal:block condition="item/has_dest|nothing" i18n:translate="">
      into <span i18n:name="history_dest">
        <a href="."
           tal:content="item/dest_title"
           tal:attributes="href string:${base_url}${item/dest_container}/">
           Foo Section
        </a>
      </span>
    </tal:block>

    <span i18n:translate="">
      by <span tal:replace="item/actor" i18n:name="history_actor">bob</span>:
      <em tal:content="item/comments|nothing" i18n:name="history_comments">
        Comments
      </em>
    </span>
    <br />
  </span>
</metal:block>

<!-- ============================================================ -->
<!-- below macros require getContentInfo 4                        -->


<!-- ============================================================ -->
<pre>display archived revisions of a document</pre>
<metal:block define-macro="archived"
      tal:define="mq nocall:modules/ZTUtils/make_query;
      getNonArchivedVersionContextUrl nocall:modules/Products.CPSDefault.utils/getNonArchivedVersionContextUrl;
      context_url python:getNonArchivedVersionContextUrl(context_url)
      ">
  <div>
    <strong i18n:translate="label_archived_revisions">Old revisions:</strong>
  </div>

  <div tal:repeat="item info/archived">
    <tal:block condition="item/is_frozen"
               define="rev item/rev">
      <span tal:replace="item/time_str">25/12/2003 11:45</span>:
      <tal:block i18n:translate="">label_revision
        <span tal:content="rev" i18n:name="status_revision">1</span>
      </tal:block>
      <tal:block i18n:translate="">label_language
        <span i18n:name="status_language">
        <tal:block i18n:translate=""
          content="string:label_language_${item/lang}">en</tal:block>
        </span>
      </tal:block>
      <tal:block condition="python:checkPerm('View archived revisions', here)">
        <a href="."
           tal:attributes="href string:${context_url}/archivedRevision/${rev}/view"
           i18n:translate="link_consult_this_revision">Consult</a>
        <tal:block condition="python:checkPerm('Modify portal content', here)">
          -
          <a href="."
             tal:attributes="href string:${context_url}/content_revert_form?rev:int=${rev}"
             i18n:translate="link_revert_to_this_revision">Revert</a>
          <tal:block condition="item/is_archived">
            -
            <a href="."
               tal:attributes="href string:${context_url}/content_delete_archive_form?rev:int=${rev}"
               i18n:translate="link_delete_this_revision">Purge</a>
          </tal:block>
        </tal:block>
      </tal:block>
    </tal:block>
  </div>
</metal:block>

</body>
</html>
