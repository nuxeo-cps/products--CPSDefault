<metal:block use-macro="here/content_lib/macros/master">
<div metal:fill-slot="main"
     tal:define="list_here python:checkPerm('List folder contents', here);
                 list_parent python:checkPerm('List folder contents', here, 'aq_parent');">

<div tal:condition="not: list_here"
  tal:define="response request/RESPONSE;url here/absolute_url;">
  <span tal:define="redirect python: response.redirect(url)"></span>
</div>

<div class="documentActions" tal:define="display_change python:request.get('change_display', '0')">
    <a href="./folder_contents?change_display=1" i18n:translate="link_change_display"
      tal:condition="python:display_change == '0'">
      Change display settings
    </a>
    <a href="./folder_contents" i18n:translate="link_hide_display_settings"
      tal:condition="python:display_change == '1'">
      Hide display settings
    </a>
</div>

<!-- ============================================================ -->
<div class="desktop">
<metal:block tal:condition="python:request.get('change_display', '0') == '1'">
<metal:block use-macro="here/box_lib/macros/sbox">
  <metal:block fill-slot="box_body">
    <form action="" method="post" name="form"
      tal:attributes="action string:${here/absolute_url};"
      tal:define="params here/getDisplayParams;
                  sort_by params/sort_by;
                  direction params/direction;
                  format params/format;">
    <strong i18n:translate="label_sort_by">sort by</strong>
       <select name="display_order">
	    <option i18n:translate="label_default" value="title" selected
                    tal:condition="python:sort_by is None">
                    Default
            </option>
	    <option i18n:translate="label_default" value="title"
                    tal:condition="python:sort_by is not None">
                    Default
            </option>
            <option i18n:translate="label_title" value="title" selected
                    tal:condition="python:sort_by == 'title'">
                    Title
            </option>
	    <option i18n:translate="label_title" value="title"
                    tal:condition="python:sort_by != 'title'">
                    Title
            </option>
	    <option i18n:translate="label_date" value="date" selected
                    tal:condition="python:sort_by == 'date'">
                    Date
            </option>
	    <option i18n:translate="label_date" value="date"
                    tal:condition="python:sort_by != 'date'">
                    Date
            </option>

	    <option i18n:translate="label_status" value="status" selected
                    tal:condition="python:sort_by == 'status'">
                    Status
            </option>
	    <option i18n:translate="label_status" value="status"
                    tal:condition="python:sort_by != 'status'">
                    Status
            </option>
          </select>

          <select name="display_direction">
	    <option i18n:translate="label_sort_asc" value="asc" selected>Asc</option>
	    <option i18n:translate="label_sort_desc" value="asc" selected>Desc</option>
	  </select>

	  <strong i18n:translate="label_display">Display with</strong>
	  <select name="display_style">
	     <option i18n:translate="label_default" value="compact" selected
	             tal:condition="python:format == None">
                     Default
	     </option>
	     <option i18n:translate="label_default" value="compact"
	             tal:condition="python:format != None">
                     Default
	     </option>
             <option i18n:translate="label_icons" value="icon" selected
	             tal:condition="python:format == 'icon'">
                     Icon
             </option>
	     <option i18n:translate="label_icons" value="icon"
	             tal:condition="python:format != 'icon'">
                     Icon
             </option>
	     <option i18n:translate="label_detailed" value="detail" selected
                     tal:condition="python:format == 'detail'">
                     Detail
             </option>
	     <option i18n:translate="label_detailed" value="detail"
                     tal:condition="python:format != 'detail'">
                     Detail
             </option>
	     <option i18n:translate="label_compact" value="compact" selected
                     tal:condition="python:format == 'compact'">
                     Compact
             </option>
	     <option i18n:translate="label_compact" value="compact"
                     tal:condition="python:format != 'compact'">
                     Compact
             </option>
           </select>
      <input type="hidden" name="change_display"
        tal:attributes="value python:request.get('change_display', 0)" />
      <input type="submit" value="button_change" i18n:attributes="value"
        tal:attributes="name string:changeListingDisplay:method" />
</form>
    </metal:block>
  </metal:block>
</metal:block>
</div>

<!-- ================================================================================= -->
<div class="Desktop">
  <tal:block condition="list_parent"
    define="upNav python: hasattr(here.aq_parent, 'portal_url');
            upID python: here.aq_parent.getId()">
    <span tal:condition="upNav | nothing">
      <a href="../folder_contents"><img src="" alt="[Link]" border="0"
        tal:attributes="src string:${base_url}UpFolder_icon.gif"></a>
    </span>&nbsp;&nbsp;
    <span tal:condition="upNav" i18n:translate="">description_up_to
      <a href="../folder_contents"
         tal:content="upID" i18n:name="up_id">Up ID</a>
    </span>
  </tal:block>

  <form action="" method="post"
      tal:attributes="action here/absolute_url">

   <tal:block define="no_form python:not checkPerm('Delete objects', here);
                      nav_action string:folder_contents;
                      items python:here.getFolderContents();">
     <metal:block use-macro="here/content_lib/macros/display_contents" />
   </tal:block>

   <table border="0" cellspacing="0" cellpadding="2">
     <tr>
      <td align="left" valign="top" width="16"></td>
      <td align="left" valign="top">
      <span tal:condition="python: test(checkPerm('Add portal content', here)
            and here.allowedContentTypes(), 1, 0)">
        <input type="submit" name="folder_factories:method" value="button_new"
               i18n:attributes="value">
      </span>
      <span tal:condition="python: checkPerm('Delete objects', here)">
        <input type="submit" name="folder_rename_form:method" value="button_rename"
               i18n:attributes="value">
        <input type="submit" name="folder_delete:method" value="button_delete"
               i18n:attributes="value">
      </span>
      </td>
     </tr>
   </table>
  </form>
</div>

</div>
</metal:block>
