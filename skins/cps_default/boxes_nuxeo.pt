<!-- nuxeo boxes macros -->
<!-- $Id$ -->


<!-- ============================================================ -->
<metal:block define-macro="box_text">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized"
                 fill-slot="box_body">
      <div class="content odd"
           tal:content="structure box/box/text">
        box text body
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="box_content">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized"
                 fill-slot="box_body">
      <div class="content odd">
       <tal:block define="
          folder python:box['box'].getFolderObject(here);
          no_form not:nothing;
          items python:box['box'].getFolderContents(here);
          format string:compact;
          columns python:1;
          items_per_page python:10">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
        </tal:block>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="box_tree">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
      box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized"
                 fill-slot="box_body">
      <div class="content odd">
        <span tal:repeat="item python:box['box'].getTree(here)">
          <span tal:replace="structure python:'&nbsp;'*4*item['depth']">&nbsp;</span>
          <a href="." tal:attributes="href string:${base_url}${item/rpath}/"><span tal:replace="structure string:${item/short_title}">id</span>
</a><span tal:condition="item/nb_children" tal:replace="string:*" /><br/>
        </span>
      </div>
    </metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="box_action"
  tal:define="items python:box['box'].getActions(here, actions)">
  <tal:block condition="python:len(items)">
  <metal:block use-macro="here/box_lib/macros/box">
    <metal:block fill-slot="box_title" tal:content="box/box/title">
       box text title
    </metal:block>
    <metal:block tal:condition="not:box/settings/minimized"
                 fill-slot="box_body">
      <tal:block repeat="category items">
        <div tal:attributes="class python:'content '
                               + test(repeat['category'].odd(), 'even', 'odd')">
          <ul>
            <li tal:repeat="action category">
              <a tal:attributes="href action/url"
                 tal:content="action/name">
                 Action
               </a>
            </li>
          </ul>
        </div>
      </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>
