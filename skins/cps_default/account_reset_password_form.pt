<html xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  metal:use-macro="here/main_template/macros/master">

  <body>
    <metal:block metal:fill-slot="main"
      tal:define="
      username python:request.get('username');
      request_emission_time python:request.get('d');
      reset_token python:request.get('t');
      membership_tool here/portal_membership;
      valid_reset_token python:
      membership_tool.isPasswordResetRequestValid(username,
                                                  request_emission_time,
                                                  reset_token);
      "
      >
      <h1 i18n:translate="heading_enter_your_new_password">
        Validate the reseting of your password</h1>

      <tal:block condition="valid_reset_token">
        <form action="register" method="post"
          tal:attributes="action string:${here/portal_url}/account_reset_password">
          <p class="buttonArea">
            <input type="hidden" name="username" value=""
              tal:attributes="value username"/>
            <input type="hidden" name="d" value=""
              tal:attributes="value request_emission_time"/>
            <input type="hidden" name="t" value=""
              tal:attributes="value reset_token"/>
            <input i18n:attributes="value" class="standalone"
              type="submit" name="submit" value="button_reset_password" />
          </p>
        </form>
      </tal:block>
      <tal:block condition="not:valid_reset_token">
        <p i18n:translate="help_invalid_reset_password_request">
          Your password reset request is invalid.
          May be you would like to try again.
        </p>
      </tal:block>

    </metal:block>
  </body>
</html>
