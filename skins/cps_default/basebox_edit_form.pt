<metal:html use-macro="here/main_template/macros/master">

<metal:main fill-slot="main">

<metal:macro define-macro="boxform"
  tal:define="box_url request/box_url|python:0;
              context_urlc python:here.getContextUrl(utool=utool, concat=1);">

<h2 i18n:translate="heading_box_edit_form">Box edition</h2>

box: <tal:block replace="box_url" />

<tal:block repeat="box boxes">
  <tal:block condition="python:box['url'] == box_url">
   <br><br>

<form action="box_edit" method="post"
  tal:attributes="action string:${context_urlc}/box_edit"
  tal:define="box_type python:box['box'].macro">
<input type="hidden" name="box_url" value=""
  tal:attributes="value box_url" />
<input type="hidden" name="box_type" value=""
  tal:attributes="value box_type" />
<table class="FormLayout">
  <tr valign="top">
    <th align="right" i18n:translate="label_title">Title</th>
    <td colspan="5">
      <input type="text" name="title" value="" size="60"
             tal:attributes="value box/box/title">
    </td>
  </tr>
  <tr valign="top">
    <th align="right" i18n:translate="label_slot">Slot</th>
    <td>
      <select name="slot">
      <tal:block repeat="slot here/getBoxSlots">
        <option value="slot"
          tal:attributes="value slot;
                          selected python:test(slot!=box['settings']['slot'], nothing, 'selected');"
           i18n:translate="" tal:content="string:label_${slot}">Slot</option>
      </tal:block>

    </td>
    <th aligh="right" i18n:translate="label_order">Order</th>
    <td><input type="text" name="order" value="" size="3"
           tal:attributes="value box/settings/order" /></td>
    <th aligh="right" i18n:translate="label_display">Display</th>
    <td>
      <select name="display">
	<option value="maximized" i18n:translate="label_maximized"
	  tal:attributes="selected python:test(box['settings']['minimized'], nothing, 'selected');">Maximized</option>
	<option value="minimized" i18n:translate="label_minimized"
	  tal:attributes="selected python:test(box['settings']['minimized'], 'selected', nothing)">Minimized</option>
	<option value="closed" i18n:translate="label_closed"
	  tal:attributes="selected python:test(box['settings']['closed'], 'selected', nothing)">Closed</option>
      </select><br>
      <input type="checkbox" name="display_in_subfolder"
      checked="" tal:attributes="checked
      python:test(box['box'].display_in_subfolder,'checked',
      nothing)"><label i18n:translate="label_visible_in_subfolder">visible in subfolder</label>
    </td>
  </tr>
  <tr valign="top">
    <th align="right" i18n:translate="label_type">Type</th>
    <td colspan="5">
      <tal:block
      define="styles python:here.getBoxesStyles(type=box_type);
              styleformat string:${box/settings/style}@${box/settings/format}"
      condition="styles">
        <tal:block replace="styles/type" /><br>
        <em><tal:block replace="styles/desc" /></em><br>
        <tal:block repeat="format styles/fmt">
          <input type="radio" name="styleformat" value=""
            tal:define="sf string:${format/style}@${format/format}"
            tal:attributes="value sf; checked python:test(sf==styleformat,'checked',nothing)" />

            <tal:block replace="format/style" />-<tal:block replace="format/format" />: <tal:block replace="format/desc" /> <br>
       </tal:block>
      </tal:block>
    </td>
  </tr>
  <metal:block define-slot="additional_fields">
  </metal:block>
  <tr >
    <td></td>
    <td colspan="5">
      <input type="submit" name="change" value="button_change"
      i18n:attributes="value"
      tal:condition="python:checkPerm('Manage Boxes', box['box'])">
      <input type="button" i18n:attributes="value" value="button_back" onClick="history.back()">
    </td>
  </tr>
</table>

</form>
<!-- XXX debug info -->
  <hr>
Render: <metal:block use-macro="python:path(box['macro'])" /><br>
Settings: <tal:block replace="box/settings" />
  <hr>
  </tal:block>
</tal:block>
</metal:macro>
</metal:main>

</metal:html>
