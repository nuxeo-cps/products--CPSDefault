<!-- nuxeo boxes macros -->
<!-- $Id$ -->

<!-- ============================================================ -->
<metal:block define-macro="basebox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title">A test box</metal:block>
    <metal:block fill-slot="box_body">Bla blabla blablaba.</metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_separator">
<hr>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_menu">
<div class="tabs"
  tal:define="sections sections|ttool/sections;
              workspaces workspaces|ttool/workspaces;
              stree python:sections.getList(start_depth=0, stop_depth=1);
              wtree python:workspaces.getList(start_depth=0, stop_depth=0)">
  <a href="" class="plain"
     tal:repeat="item wtree"
     tal:attributes="href string:${base_url}${item/rpath}/;
                     class python:test(context_url.endswith(item['rpath']),
                                       'selected', default);
                     title item/title"
     tal:content="structure item/short_title">
     workspace title
  </a>
  <a href="" class="plain"
     tal:repeat="item stree"
     tal:attributes="href string:${base_url}${item/rpath}/;
                     class python:test(context_url.endswith(item['rpath']),
                                       'selected' or default);
                     title item/title"
     tal:content="structure item/short_title">
     section title
  </a>
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_logo">
<a href="http://www.nuxeo.com/"
   tal:attributes="href string:${base_url}">
  <img height="43" width="173" border="0" src="logo_nuxeo.gif" class="logo"
    alt="Nuxeo Logo" title="Nuxeo Web Site"
    tal:attributes="src string:${base_url}logo_nuxeo.gif" />
</a>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_search">
<div class="searchBox">
  <form method="get" action="search"
    tal:attributes="action string:${base_url}search_form">
    <a href="search_form"
      tal:attributes="href string:${base_url}advanced_search_form"
      i18n:translate="link_advanced_search">
      Advanced search</a>
    <br>
    <input id="searchGadget" type="text" name="SearchableText" size="20"
      value="" tal:attributes="value request/SearchableText|nothing">
    <input class="context searchButton" type="submit" value="button_ok"
      i18n:attributes="value">
  </form>
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_breadcrumbs">
<div class="pathBar">
  <tal:block i18n:translate="label_you_are_here">You are
  here:&nbsp;</tal:block><tal:block repeat="bc
  python:here.getBreadCrumbs(url=context_url, breadcrumb_set=getattr(request,
  'breadcrumb_set', None))">
    <a href="/cps/id"
       tal:omit-tag="not:bc/url"
       tal:attributes="href bc/url;
                       title bc/longtitle"
       tal:content="bc/title">
       Title
    </a><strong
    tal:condition="not:repeat/bc/end">&nbsp;&gt;&nbsp;</strong></tal:block>
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_folder_header"
  tal:define="doc doc|here/getContent|nocall:here">
<h1 tal:content="here/title_or_id">Page Title</h1>
<div class="description">&nbsp;<span
  tal:content="doc/Description">description</span>
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_l10n_select">
<tal:block replace="structure here/Localizer/changeLanguageForm" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_footer">
<div class="footer">
  Nuxeo - 14, rue du Soleillet, 75020 Paris France
  <br>
  Email : <a href="mailto:contact@nuxeo.com">contact@nuxeo.com</a>
  - Tél: +33 (0)1 40 33 79 87 - Fax: +33 (0)1 43 58 14 15
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="basebox_welcome">
<br><br><br>
<div class="footer" i18n:translate="">
  welcome_cps <span  i18n:name="cps_link"><a target="nuxeo"
  href="http://www.nuxeo.com/">Nuxeo</a></span>
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="textbox_default">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>
    <metal:block fill-slot="box_body"
      tal:content="structure box/box/text">box text body</metal:block>
  </metal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_default"
  tal:define="ret python:box['box'].getContents(here);
              items python:ret[0];
              link_more python:ret[1];">
  <tal:block condition="python:len(items)">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title" i18n:translate=""
      tal:content="box/box/title">box text title</metal:block>
    <metal:block fill-slot="box_body">
       <tal:block define="
          no_form not:nothing;
          format box/box/display;
          items_per_page box/box/nb_items|python:10;
          nav_action string:folder_view">
          <metal:block use-macro="here/content_lib/macros/display_contents" />
          <div tal:condition="link_more">
            <a href="" tal:attributes="href string:${base_url}${link_more}">More ...</a>
          </div>
       </tal:block>
    </metal:block>
  </metal:block>
  </tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="contentbox_last_modified">
  <metal:block use-macro="here/boxes_nuxeo/macros/contentbox_default" />
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_default"
  tal:define="items python:box['box'].getTree(here);">
<tal:block condition="python: len(items)>0">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="box/box/title" i18n:translate="">
       box text title
    </metal:block>
    <metal:block fill-slot="box_body">
      <tal:block repeat="item items"><span tal:replace="structure
          python:'&nbsp;'*4*item['depth']">&nbsp;</span><a href="."
          tal:attributes="class python:test(context_url.endswith(
                                item['rpath']),'selected', default);
                          href string:${base_url}${item/rpath}/;"><span
          tal:replace="structure string:${item/short_title}">id
          </span></a><span tal:condition="item/nb_children"
          tal:replace="string:*" /><br></tal:block>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="treebox_center"
  tal:define="items python:box['box'].getTree(here);">
<tal:block condition="python: len(items)>0">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title"
      tal:content="here/title_or_id">Page Title
    </metal:block>
    <metal:block fill-slot="box_body">
    <tal:block define="root python:items[0];
                      depth python:root['depth']+1;
                      items python:items[1:];
                      nb_item python:len(items);
                      global treenb_row  python:nb_item/2+2;">
      <table width="100%">
    <tr>
      <td colspan="2">
        <tal:block condition="python: checkPerm('List folder contents', here,
'aq_parent')">
        <a href="../">
        <img src="" alt="[Link]" border="0"
          tal:attributes="src string:${base_url}UpFolder_icon.gif">
        <span i18n:translate="">description_up_to
          <b i18n:name="up_id" tal:content="python:here.aq_parent.getId()">
          Up ID</b>
        </span>
        </a><br><br>
        </tal:block>
      </td>
    </tr>
        <tr><td valign="top" width="50%">
        <tal:block repeat="item items">
          <tal:block condition="python:item['depth']==depth">
          <br tal:condition="not:repeat/item/start" />
          <tal:block condition="python:repeat['item'].number() >= treenb_row">
            <tal:block replace='structure string:</td><td width="50%" valign="top">'
              define="global treenb_row python:nb_item + 1"/>
          </tal:block>

        <tal:block define="global last_child python: repeat['item'].number() + item['nb_children']" />
<b><a href="." tal:attributes="href string:${base_url}${item/rpath}/" ><img src="" alt="[Link]" border="0"
      tal:attributes="src string:${base_url}folder_icon.gif" />&nbsp;<span tal:replace="structure string:${item/title_or_id}">title</span></a></b><span tal:condition="item/nb_children" tal:replace="string::" /><br/>
          </tal:block>
          <tal:block condition="python:item['depth']>depth">
<a href="." tal:attributes="href string:${base_url}${item/rpath}/"><span tal:replace="structure string:${item/title_or_id}">title</span></a><span tal:condition="item/nb_children" tal:replace="string:..." /><span tal:condition="python: repeat['item'].number() != last_child">,&nbsp;</span><span tal:condition="python: repeat['item'].number() == last_child">.<br/></span>
          </tal:block>
        </tal:block>
        </td></tr></table><br>
   </tal:block>
   </metal:block>
  </metal:block>
</tal:block>
</metal:block>


<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_default"
  tal:define="items python:box['box'].getActions(here, actions)">
<tal:block condition="items">
  <metal:block use-macro="python:path(box['settings']['box_skin'])">
    <metal:block fill-slot="box_title">
      <metal:block define-slot="box_title">
        <tal:block i18n:translate=""
          content="box/box/title">box text title</tal:block>
      </metal:block>
    </metal:block>
    <metal:block fill-slot="box_body">
      <tal:block repeat="category items">
      <tal:block condition="python:len(category)">
        <br tal:condition="not:repeat/category/start">
          <li tal:repeat="action category"><a i18n:translate=""
            tal:attributes="href action/url"
            tal:content="action/name">Action</a></li>
      </tal:block>
      </tal:block>
    </metal:block>
  </metal:block>
</tal:block>
</metal:block>

<!-- ============================================================ -->
<!-- actions should be define like in main_template -->
<!-- actions python:atool.listFilteredActionsFor(here); -->
<metal:block define-macro="actionbox_user">
  <metal:block use-macro="here/boxes_nuxeo/macros/actionbox_default">
    <metal:block fill-slot="box_title">
      <tal:block define="mtool here/portal_membership;
                         url nocall:here/portal_url;
                         dtool here/portal_metadirectories;
                         dirname string:members;
                         directory dtool/?dirname;
                         entry python:directory.getEntry(uname);
                        ">

         <tal:block define="notLogged python:mtool.isAnonymousUser()">
           <span tal:condition="notLogged"
                 i18n:translate="label_guest"
                 tal:content="uname">
              box text title
           </span>
           <a href="."
              tal:condition="python:notLogged == 0 and entry is not  None"
              tal:attributes="href string:${here/portal_url}/workspaces/members/${uname}"
              tal:content="python:entry.get('fullname', uname)" >
              box text title
           </a>
           <a href="."
              tal:condition="python:notLogged == 0 and entry is None"
              tal:attributes="href string:${here/portal_url}/workspaces/members/${uname}"
              tal:content="uname" >
              box text title
           </a>
         </tal:block>
      </tal:block>
    </metal:block>
  </metal:block>
</metal:block>
