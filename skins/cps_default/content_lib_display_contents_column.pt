<!-- a content_lib macro -->
<!-- $Id$ -->

<!-- Final display of items in a column using the given format -->

<metal:block define-macro="display_contents_column">
  <tal:block define="no_form no_form|nothing;
                     site_wide site_wide|nothing;
                     format python:format or 'detail';
                     choosen_ids python:request.SESSION.get('choosen_ids', []);
                     dummy python:request.SESSION.update({'choosen_ids': []});
                     no_table python:format == 'detail_tab';
                     use_radio use_radio|nothing;
                     input_type python: test(use_radio, 'radio', 'checkbox');
                     input_name python: test(use_radio, 'ids', 'ids:list');
                     member here/portal_membership/getAuthenticatedMember;
                     member_id member/id;
                     member_roles member/getRoles;
">
  <table tal:condition="python: not no_table and batch_items" width="100%" cellspacing="0"
    cellpadding="5" summary="content column layout">
    <tal:block tal:repeat="item batch_items">
      <tal:block define="info python:here.getContentInfo(item, level=1, cpsmcat=cpsmcat);
                         review_state python:info['review_state'];
                         proxy_creator item/Creator|info/creator"
                 condition="python:review_state != 'draft'
                                   or (review_state == 'draft' and proxy_creator == member_id)
                                   or 'Manager' in member_roles">
      <tr valign="top">
        <td tal:condition="not:no_form" align="left" valign="top" width="5">
        <input type="" name="" value="" id="" class="noborder"
           tal:define="id item/getId"
           tal:condition="python:review_state not in ('locked', 'draft')
                                 or 'Manager' in member_roles"
           tal:attributes="value
             python:site_wide and item.getContextUrl(utool=utool) or id;
             id python:'cb_' + id;
             checked python:id in choosen_ids;
             type python:input_type;
             name python:input_name;
           " />
        </td>
        <td align="left" valign="top">
          <metal:block use-macro="python:path('here/content_lib_info_%s/macros/info_%s'%(format,format))" />
        </td>
      </tr>
      </tal:block>
    </tal:block>
  </table>
  <tal:block condition="no_table">
    <tal:block repeat="item batch_items">
    <tal:block define="info python:here.getContentInfo(item, level=1, cpsmcat=cpsmcat);
                        review_state python:info['review_state'];
                        proxy_creator python:item.Creator();
                        start repeat/item/start|nothing;
                        end repeat/item/end|nothing">
      <tal:block tal:condition="python:review_state!='draft' or (review_state=='draft' and proxy_creator == member_id) or 'Manager' in member_roles">
      <metal:block use-macro="here/content_lib_info_detail_tab/macros/info_detail_tab" />
      </tal:block>
    </tal:block>
    </tal:block>
  <br />
  </tal:block>
  </tal:block>
</metal:block>
