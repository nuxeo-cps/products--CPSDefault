<!-- macro library for all general use -->
<!-- $Id$ -->

<!-- ============================================================ -->
<metal:block define-macro="portal_message">
<div class="message"
     tal:define="portal_status_message portal_status_message |
                                       request/portal_status_message |
                                       nothing"
     tal:condition="portal_status_message"
     tal:content="portal_status_message"
     i18n:translate="">
  Translated status message.
</div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="breadcrumbs">
  <tal:block i18n:translate="label_you_are_here">You are
  here:&nbsp;</tal:block><tal:block repeat="bc
  python:here.getBreadCrumbs(url=context_url, breadcrumb_set=getattr(request,
  'breadcrumb_set', None))">
    <a href="/cps/id"
       tal:omit-tag="not:bc/url"
       tal:attributes="href bc/url;
                       title bc/longtitle|nothing;
                       accesskey python:test(repeat['bc'].end, nothing, 'U')"
       tal:content="bc/title">
       Title
    </a><strong
    tal:condition="not:repeat/bc/end">&nbsp;&gt;&nbsp;</strong></tal:block>
</metal:block>

<!-- ============================================================ -->
<metal:block define-macro="search_folder_prefix_option"
  tal:define="id sfpo_id|string:fp;id1 string:${id}1; id2 string:${id}2;
  contextualSearch python:request.has_key('folder_prefix') and request.get('folder_prefix')
  ">
  <input type="radio" name="folder_prefix" class="noborder"
    tal:attributes="id id1;
      checked contextualSearch;
      value python: utool.getRelativeUrl(here)" />
  <label tal:attributes="for id1"
    i18n:translate="label_search_here">here</label>
  <input type="radio" name="folder_prefix" value="" class="noborder"
    tal:attributes="id id2;
    checked not:contextualSearch" />
  <label tal:attributes="for id2"
    i18n:translate="label_search_all_site">all</label><br />
</metal:block>

<metal:block define-macro="search_form">
  <div class="group">
  <table border="0" width="100%" cellpadding="1" cellspacing="1"
    summary="search form layout">
    <tr>
      <td align="right" valign="top">
        <div class="label" i18n:translate="label_search_title" /></td>
      <td><input id="field_focus" name="Title" size="20" /></td>
    </tr>
    <tr>
      <td align="right" valign="top">
        <div class="label" i18n:translate="label_search_description" /></td>
      <td><input name="Description" size="20" /></td>
    </tr>
    <tr valign="top">
      <td align="right" valign="top">
        <div class="label" i18n:translate="label_search_full_text" /></td>
      <td><input name="SearchableText" size="40" /></td>
    </tr>
    <tr tal:condition="not:isAnon">
      <td align="right" valign="top">
        <div class="label" i18n:translate="label_search_status" /></td>
      <td>
      <select name="review_state">
        <option i18n:translate="label_all" value="" selected="selected">All</option>
        <tal:block repeat="stateName python:here.getWorkflowStateNames()">
          <option tal:attributes="value stateName"
                tal:content="python: 'label_' + stateName" i18n:translate="">State name</option>
        </tal:block>
      </select>
      </td>
      </tr>
      <tr>
        <td align="right" valign="top">
          <div class="label" i18n:translate="label_search_portal_type" /></td>
        <td>
          <select size="5" name="portal_type" multiple="multiple">
            <option i18n:translate="label_all" value="" selected="selected">All</option>
              <tal:block repeat="ret python:here.getSortedContentTypes(allowed=0)">
            <option tal:define="type ret/id;name ret/title;"
              tal:attributes="value type;" i18n:translate=""
              tal:content="name"></option>
              </tal:block>
          </select>
        </td>
      </tr>
      <tr>
        <td align="right" valign="top">
          <div class="label" i18n:translate="label_subject" /></td>
        <td>
          <select size="5" name="Subject" multiple="multiple">
            <option i18n:translate="label_all" value="" selected="selected">All</option>
            <tal:block repeat="subjectVocItem python:here.getSortedSubjects().items()">
              <option tal:define="id python:subjectVocItem[0]; name python:subjectVocItem[1];"
                tal:attributes="value id;" i18n:translate=""
                tal:content="name"></option>
            </tal:block>
          </select>
        </td>
      </tr>
      <tr>
        <td align="right" valign="top">
          <div class="label" i18n:translate="label_search_modified_since" />
        </td>
        <td tal:define="today python: here.ZopeTime().earliestTime();
                        mtool here/portal_membership;
                        member python:mtool.getAuthenticatedMember();
                        lastLogin member/last_login_time|nothing;
                        yesterday python:(today-1).Date();
                        lastWeek python:(today-7).Date();
                        lastMth python:(today-31).Date();">
         <select name="modified:date">
           <option value="1970/01/01 00:00:00 GMT"
                   i18n:translate="label_choose">Choisir
           </option>
           <option i18n:translate="time_last_login"
                   tal:attributes="value lastLogin"
                   tal:condition="python:not(here.portal_membership.isAnonymousUser())">
             time_last_login
           </option>
           <option i18n:translate="time_yesterday"
                   tal:attributes="value yesterday">time_yesterday</option>
           <option i18n:translate="time_last_week"
                   tal:attributes="value lastWeek">time_last_week</option>
           <option i18n:translate="time_last_month"
                   tal:attributes="value lastMth">time_last_month</option>
         </select>
         <input type="hidden" name="modified_usage" value="range:min" />
         </td>
      </tr>
      <tr>
        <td align="right" valign="top">
          <div class="label" i18n:translate="label_search_location" /></td>
        <td>
          <metal:block
            use-macro="here/generic_lib/macros/search_folder_prefix_option"
          /></td>
      </tr>
      <tr>
        <td></td>
        <td><br /><input type="submit" class="standalone" i18n:attributes="value"
                   value="button_search" /></td>
      </tr>
   </table>
   </div>
</metal:block>


<!-- ============================================================ -->
<metal:block define-macro="accessibility">
<div class="hidden">
  <a accesskey="0" tal:attributes="href string:${base_url}accessibility"
    i18n:translate="accessibility_page_link">Accessibility</a>
  <a accesskey="1" tal:attributes="href string:${base_url}"
    i18n:translate="accessibility_home_link">Go to the homepage</a>
  <a accesskey="2" href="#content"
    i18n:translate="accessibility_content_link">Go to the content</a>
  <a accesskey="3" href="#menu"
    i18n:translate="accessibility_menu_link">Go to the menu</a>
  <a accesskey="4" tal:attributes="href string:${base_url}advanced_search_form"
    i18n:translate="accessibility_search_link">Go to search engine</a>
  <a accesskey="9"
    tal:define="contact_email here/portal_properties/email_from_address"
    tal:attributes="href string:mailto:${contact_email}?subject=Info"
    i18n:translate="accessibility_contact_link">Contact</a>
</div>
</metal:block>
